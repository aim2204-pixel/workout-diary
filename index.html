<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–æ–π –î–Ω–µ–≤–Ω–∏–∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
     <link rel="manifest" href="/workout-diary/manifest.json" crossorigin="use-credentials">
     <meta name="theme-color" content="#9d4edd">
     <meta name="mobile-web-app-capable" content="yes">    
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –ü–†–ï–ñ–ù–ò–ú–ò - –°–û–•–†–ê–ù–ò–õ –ò–• –î–õ–Ø –ö–û–†–û–ß–ù–û–°–¢–ò */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #f0f0f0; min-height: 100vh; padding-bottom: 60px; line-height: 1.4; }
        .app-header { background: rgba(0, 30, 60, 0.95); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #9d4edd; }
        .header-titles { text-align: left; }		
        .app-header h1 { font-size: 1.4rem; font-weight: 700; color: #fff; line-height: 1.2; }
        .app-header .subtitle { font-size: 0.8rem; opacity: 0.8; }
        .app-header .subtitle.diary-subtitle { font-weight: bold; color: #ffd166; }
        .header-add-btn { background: #9d4edd; color: white; border: none; width: 42px; height: 42px; border-radius: 50%; font-size: 1.5rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 8px rgba(0,0,0,0.3); transition: all 0.2s; }
        .header-add-btn:hover { background: #7b2cbf; transform: scale(1.05); }
        .content-area { padding: 12px; max-width: 800px; margin: 0 auto; }
        .workout-list { display: flex; flex-direction: column; gap: 14px; margin-top: 10px; }
        .workout-card { background: rgba(255, 255, 255, 0.08); border-radius: 12px; padding: 14px; border-left: 5px solid #9d4edd; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2); position: relative; }
        .workout-card[data-type="circuit"] { border-left-color: #48bb78; }
        .workout-card[data-type="home"] { border-left-color: #ffb347; }
        .workout-card[data-type="other"] { border-left-color: #00b4d8; }
        .workout-date { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-right: 100px; }
        .date-text { font-size: 1.15rem; font-weight: 600; color: #90e0ef; }
        .workout-type { color: white; padding: 4px 12px; border-radius: 16px; font-size: 0.78rem; font-weight: 600; margin-top: 4px; }
        .type-strength { background-color: #9d4edd; }
        .type-circuit { background-color: #48bb78; }
        .type-home    { background-color: #ffb347; }
        .type-other   { background-color: #00b4d8; }
        .workout-actions { position: absolute; top: 14px; right: 14px; display: flex; gap: 8px; }
        .workout-copy-btn, .workout-edit-btn, .workout-delete-btn { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.7); border: none; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; transition: all 0.2s; }
        .workout-copy-btn:hover { background: rgba(72, 187, 120, 0.3); color: #48bb78; }
        .workout-edit-btn:hover { background: rgba(157, 78, 221, 0.3); color: #9d4edd; }
        .workout-delete-btn:hover { background: rgba(220, 53, 69, 0.3); color: #f8a5a5; }
        .exercises-block { margin: 10px 0 6px 0; }
        .exercise-item { background: rgba(0, 30, 60, 0.4); margin: 6px 0; padding: 10px 12px; border-radius: 8px; border-left: 4px solid #0077b6; }
        .exercise-item:first-child { margin-top: 0; }
        .exercise-item:last-child { margin-bottom: 0; }
        .exercise-name-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .exercise-main-name { font-weight: 700; font-size: 1rem; color: #caf0f8; display: flex; align-items: center; gap: 6px; }
        .exercise-number { color: #9d4edd; font-weight: 800; font-size: 0.9em; min-width: 1.2em; }
        .exercise-spec {
    font-size: 0.85rem;
    color: #90e0ef;
    font-style: italic;
    white-space: pre-wrap; /* ‚Üê –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ */
    word-wrap: break-word;
    max-width: 100%;
    display: block;
    margin-top: 4px;
}
        .weight-details {
    background: rgba(157, 78, 221, 0.15);
    padding: 6px 10px;
    border-radius: 6px;
    margin: 4px 0;
    font-family: monospace;
    white-space: pre-line; /* ‚Üê –£–ñ–ï –ï–°–¢–¨, –Ω–æ –ø—Ä–æ–≤–µ—Ä—å */
    color: #fff;
    font-weight: 700;
    font-size: 0.9rem;
}
        .exercise-note {
    margin-top: 6px;
    padding-top: 6px;
    border-top: 1px dashed rgba(255, 255, 255, 0.15);
    font-weight: 400;
    text-decoration: underline;
    color: #b5e48c;
    font-size: 0.88rem;
    white-space: pre-wrap; /* ‚Üê –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ */
    word-wrap: break-word;
    max-width: 100%;
    display: block;
}
        .extra-activity { margin-top: 12px; padding: 8px 12px; background: rgba(72, 187, 120, 0.2); border-radius: 8px; border-left: 4px solid #48bb78; color: #c6f6d5; font-size: 0.9rem; }
        .metrics { display: flex; justify-content: space-around; margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(255, 255, 255, 0.1); }
        .metric-value { font-size: 1.35rem; font-weight: 800; color: #ffd166; }
        .metric-label { font-size: 0.8rem; opacity: 0.9; margin-top: 2px; }
        .form-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.85); z-index: 2000; overflow-y: auto; }
        .form-container { background: #1a1a2e; margin: 30px auto; max-width: 700px; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #9d4edd; }
        .form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #9d4edd; }
        .form-header h2 { color: #90e0ef; font-size: 1.6rem; }
        .btn-close-form { background: transparent; color: #aaa; border: none; font-size: 1.8rem; cursor: pointer; padding: 5px 10px; border-radius: 5px; transition: color 0.3s; }
        .btn-close-form:hover { color: #fff; }
        .workout-form { display: flex; flex-direction: column; gap: 25px; }
        .form-section { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 25px; border-left: 4px solid #00b4d8; }
        .form-section h3 { color: #caf0f8; margin-bottom: 20px; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; }
        .form-row { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
        .form-row:last-child { margin-bottom: 0; }
        .form-group { flex: 1; min-width: 250px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #caf0f8; font-size: 0.95rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 15px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 10px; color: #fff; font-size: 1rem; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #00b4d8; background: rgba(255, 255, 255, 0.15); }
        .form-group textarea { resize: vertical; min-height: 80px; font-family: inherit; }
        .hint { font-size: 0.85rem; color: #aaa; margin-top: 5px; }
        .exercises-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .exercises-table thead th { padding: 12px 8px; text-align: left; color: #90e0ef; font-weight: 600; border-bottom: 2px solid rgba(255,255,255,0.2); font-size: 0.9rem; }
        .exercises-table tbody tr { border-bottom: 1px solid rgba(255,255,255,0.1); }
        .exercises-table tbody tr:last-child { border-bottom: none; }
        .exercises-table td { padding: 12px 8px; vertical-align: top; }
        .exercise-row-actions { text-align: center; }
        
		.order-buttons {
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-items: center;
}

.btn-move-up,
.btn-move-down {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
    font-size: 0.8rem;
    background: rgba(157, 78, 221, 0.2);
    color: #d9bbff;
    border-color: rgba(157, 78, 221, 0.4);
}

.btn-move-up:hover {
    background: rgba(157, 78, 221, 0.4);
    transform: translateY(-1px);
}

.btn-move-down:hover {
    background: rgba(157, 78, 221, 0.4);
    transform: translateY(1px);
}

.btn-move-up:disabled,
.btn-move-down:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    background: rgba(157, 78, 221, 0.1) !important;
    border-color: rgba(157, 78, 221, 0.2) !important;
    color: rgba(217, 187, 255, 0.5) !important;
}

.btn-move-up:disabled:hover,
.btn-move-down:disabled:hover {
    transform: none !important;
    background: rgba(157, 78, 221, 0.1) !important;
}

/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è */
.btn-remove-row {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
    font-size: 0.8rem;
    background: rgba(220, 53, 69, 0.2);
    color: #f8a5a5;
    border-color: rgba(220, 53, 69, 0.4);
    margin-top: 4px;
}

.btn-remove-row:hover {
    background: rgba(220, 53, 69, 0.4);
    transform: translateY(-1px);
}
        .weight-sets-container { display: flex; flex-direction: column; gap: 8px; }
        .weight-set-row { display: flex; gap: 8px; align-items: center; }
        .weight-set-input { flex: 2; min-width: 120px; }
        .sets-input, .reps-input { flex: 1; min-width: 60px; }
        .btn-add-weight-set { background: rgba(72, 187, 120, 0.2); color: #c6f6d5; border: 1px solid rgba(72, 187, 120, 0.4); border-radius: 6px; padding: 6px 10px; cursor: pointer; font-size: 0.85rem; transition: all 0.3s; align-self: flex-start; }
        .btn-add-weight-set:hover { background: rgba(72, 187, 120, 0.4); }
        .btn-add-exercise { background: rgba(72, 187, 120, 0.2); color: #c6f6d5; border: 1px solid #48bb78; border-radius: 10px; padding: 12px 20px; margin-top: 15px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-add-exercise:hover { background: rgba(72, 187, 120, 0.4); transform: translateY(-2px); }
        .weight-bmi-row { display: flex; align-items: flex-end; gap: 20px; }
        .bmi-display { background: rgba(255, 209, 102, 0.1); border: 1px solid rgba(255, 209, 102, 0.3); border-radius: 10px; padding: 12px 15px; min-width: 150px; }
        .bmi-display .bmi-value { font-size: 1.5rem; font-weight: 800; color: #ffd166; }
        .bmi-display .bmi-label { font-size: 0.8rem; opacity: 0.9; margin-top: 3px; }
        .form-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 20px; }
        .btn-cancel, .btn-submit { padding: 15px 30px; border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; }
        .btn-cancel { background: rgba(255, 255, 255, 0.1); color: #f0f0f0; border: 1px solid rgba(255, 255,255, 0.3); }
        .btn-cancel:hover { background: rgba(255, 255, 255, 0.2); }
        .btn-submit { background: linear-gradient(to right, #00b4d8, #0077b6); color: white; border: none; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 180, 216, 0.4); }
        .exercises-card, .profile-card, .graph-container, .timer-card { background: rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 25px; margin-top: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .exercises-card { border-left: 5px solid #48bb78; }
        .profile-card { border-left: 5px solid #00b4d8; }
        .graph-container { border-left: 5px solid #ffd166; }
        .timer-card { border-left: 5px solid #9d4edd; }
        .exercises-card h2, .profile-card h2, .graph-container h3, .timer-card h2 { color: #90e0ef; margin-bottom: 20px; font-size: 1.4rem; }
        .exercises-card h2 i, .profile-card h2 i, .graph-container h3 i, .timer-card h2 i { margin-right: 10px; }
        .input-with-button { display: flex; gap: 10px; }
        .input-with-button input { flex: 1; padding: 12px 15px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 10px; color: #fff; font-size: 1rem; }
        .btn-add, .btn-save { background: linear-gradient(to right, #48bb78, #2d8555); color: white; border: none; padding: 12px 25px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-add:hover, .btn-save:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4); }
        .exercises-list-container { margin-top: 20px; }
        .exercises-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
        .exercise-list-item { background: rgba(0, 30, 60, 0.4); padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78; display: flex; justify-content: space-between; align-items: center; transition: background 0.3s; }
        .exercise-list-item:hover { background: rgba(0, 30, 60, 0.6); }
        .exercise-list-name { font-weight: 600; color: #caf0f8; font-size: 1.05rem; }
        .exercise-list-name.editing { display: none; }
        .exercise-list-edit-input { flex: 1; padding: 8px 12px; margin-right: 10px; background: rgba(255, 255, 255, 0.15); border: 1px solid #48bb78; border-radius: 6px; color: #fff; font-size: 1rem; display: none; }
        .exercise-list-edit-input.editing { display: block; }
        .exercise-list-actions { display: flex; gap: 8px; }
        .btn-edit, .btn-save-edit, .btn-cancel-edit, .btn-delete { padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; border: 1px solid transparent; }
        .btn-edit { background: rgba(255, 209, 102, 0.2); color: #ffd166; border-color: rgba(255, 209, 102, 0.4); }
        .btn-edit:hover { background: rgba(255, 209, 102, 0.3); }
        .btn-save-edit { background: rgba(72, 187, 120, 0.3); color: #c6f6d5; border-color: #48bb78; display: none; }
        .btn-save-edit:hover { background: rgba(72, 187, 120, 0.5); }
        .btn-cancel-edit { background: rgba(108, 117, 125, 0.3); color: #dee2e6; border-color: rgba(108, 117, 125, 0.5); display: none; }
        .btn-cancel-edit:hover { background: rgba(108, 117, 125, 0.5); }
        .btn-delete { background: rgba(220, 53, 69, 0.2); color: #f8a5a5; border-color: rgba(220, 53, 69, 0.4); }
        .btn-delete:hover { background: rgba(220, 53, 69, 0.4); }
        .empty-list-message { text-align: center; padding: 40px 20px; color: #888; font-style: italic; border: 2px dashed rgba(255, 255, 255, 0.1); border-radius: 10px; background: rgba(0,0,0,0.2); }
        .graph-placeholder { padding: 40px 20px; text-align: center; color: #888; font-style: italic; border: 2px dashed rgba(255, 255, 255, 0.1); border-radius: 10px; background: rgba(0,0,0,0.2); }
        .notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.9); color: white; padding: 15px 25px; border-radius: 10px; z-index: 9999; font-size: 0.95rem; box-shadow: 0 5px 20px rgba(0,0,0,0.5); display: none; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0, 20, 40, 0.98); display: flex; justify-content: space-around; padding: 12px 5px; border-top: 1px solid rgba(157, 78, 221, 0.5); box-shadow: 0 -5px 15px rgba(0,0,0,0.3); z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #90e0ef; text-decoration: none; padding: 8px 5px; border-radius: 10px; transition: all 0.3s; flex: 1; max-width: 90px; }
        .nav-item.active { background: rgba(157, 78, 221, 0.25); color: #fff; }
        .nav-item i { font-size: 1.3rem; margin-bottom: 4px; }
        .nav-item span { font-size: 0.75rem; font-weight: 600; }
        .empty-state { text-align: center; padding: 50px 20px; color: #888; }
        .empty-state i { font-size: 3rem; margin-bottom: 15px; opacity: 0.5; }
        .empty-state h3 { margin-bottom: 10px; color: #aaa; }
        .empty-state p { color: #777; }
        
        /* ==================== –°–ü–†–ò–ù–¢ 6: –°–¢–ò–õ–ò –ì–†–ê–§–ò–ö–ê ==================== */
        .graph-controls {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(157, 78, 221, 0.3);
        }
        .period-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .period-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: #ccc;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 100px;
            text-align: center;
        }
        .period-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .period-btn.active {
            background: linear-gradient(135deg, #00b4d8, #0077b6);
            color: white;
            border-color: #00b4d8;
            box-shadow: 0 4px 12px rgba(0, 180, 216, 0.4);
        }
        .extremes-info {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-size: 0.95rem;
        }
        .extremes-min, .extremes-max {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .extremes-min i {
            color: #48bb78;
        }
        .extremes-max i {
            color: #ff6b6b;
        }
        .extremes-min span, .extremes-max span {
            font-weight: 800;
            font-size: 1.1rem;
        }
        
        /* ==================== –¢–ê–ô–ú–ï–† (–°–ü–†–ò–ù–¢ 7) ==================== */
        .timer-display {
            font-size: 5rem;
            font-weight: 800;
            color: #ffd166;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 209, 102, 0.5);
            line-height: 1;
            text-align: center;
        }
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .timer-btn {
            padding: 15px 25px;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 140px;
            justify-content: center;
        }
        .timer-btn-start {
            background: linear-gradient(135deg, #48bb78, #2d8555);
            color: white;
        }
        .timer-btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.4);
        }
        .timer-btn-lap {
            background: linear-gradient(135deg, #9d4edd, #7b2cbf);
            color: white;
        }
        .timer-btn-lap:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(157, 78, 221, 0.4);
        }
        .timer-btn-reset {
            background: rgba(255, 255, 255, 0.15);
            color: #f0f0f0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .timer-btn-reset:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }
        .timer-laps {
            margin-top: 30px;
        }
        .timer-laps h3 {
            color: #caf0f8;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .laps-container {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
        }
        .lap-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #00b4d8;
            transition: background 0.3s;
        }
        .lap-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .lap-number {
            color: #9d4edd;
            font-weight: 800;
            font-size: 1.1rem;
            min-width: 40px;
        }
        .lap-time {
            font-family: monospace;
            font-size: 1.4rem;
            font-weight: 700;
            color: #ffd166;
        }
        .empty-laps {
            text-align: center;
            padding: 40px 20px;
            color: #888;
            font-style: italic;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0,0,0,0.2);
        }
        .timer-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
        }
        .stat-box {
            text-align: center;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: #90e0ef;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 5px;
        }
        
          
        /* ==================== –°–ü–†–ò–ù–¢ 7: –°–¢–ò–õ–ò –≠–ö–°–ü–û–†–¢–ê/–ò–ú–ü–û–†–¢–ê ==================== */
        .btn-export, .btn-import {
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }

        .btn-export {
            background: linear-gradient(135deg, #48bb78, #2d8555);
            color: white;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-import {
            background: linear-gradient(135deg, #9d4edd, #7b2cbf);
            color: white;
        }

        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.4);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞ */
        .import-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            overflow-y: auto;
        }

        .import-modal-content {
            background: #1a1a2e;
            margin: 50px auto;
            max-width: 600px;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 2px solid #9d4edd;
        }

        .import-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .import-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00b4d8;
            cursor: pointer;
            transition: all 0.3s;
        }

        .import-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .import-option input[type="radio"] {
            margin-right: 10px;
        }

        .import-option label {
            font-weight: 600;
            color: #caf0f8;
            cursor: pointer;
        }

        .import-option .hint {
            margin-top: 5px;
            color: #aaa;
            font-size: 0.85rem;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤ */
        @media (max-width: 600px) {
            .period-filters {
                flex-direction: column;
            }
            .period-btn {
                min-width: 100%;
            }
            .extremes-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ç–∞–π–º–µ—Ä–∞ */
        @media (max-width: 768px) {
            .timer-display {
                font-size: 3.5rem;
            }
            .timer-btn {
                min-width: 120px;
                padding: 12px 20px;
                font-size: 1rem;
            }
            .timer-controls {
                gap: 15px;
            }
        }
        @media (max-width: 480px) {
            .timer-display {
                font-size: 2.8rem;
            }
            .timer-btn {
                min-width: 100%;
                margin-bottom: 10px;
            }
            .timer-controls {
                flex-direction: column;
            }
            .timer-stats {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .form-container { margin: 10px; padding: 20px; }
            .form-row { flex-direction: column; gap: 15px; }
            .form-group { min-width: 100%; }
            .exercises-table thead { display: none; }
            .exercises-table tbody tr { display: flex; flex-direction: column; margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; }
            .exercises-table td { display: block; padding: 8px 0; border: none; }
            .exercises-table td:before { content: attr(data-label); font-weight: 600; color: #90e0ef; display: block; margin-bottom: 5px; font-size: 0.9rem; }
            .exercise-row-actions { text-align: left; margin-top: 10px; }
            .input-with-button { flex-direction: column; }
            .weight-bmi-row { flex-direction: column; align-items: stretch; gap: 15px; }
            .exercise-list-actions { flex-wrap: wrap; }
            .weight-set-row { flex-direction: column; align-items: stretch; }
            .weight-set-input, .sets-input, .reps-input { min-width: 100%; }
            .workout-date { padding-right: 90px; }
            
            /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ */
            .btn-export, .btn-import {
                min-width: 100%;
            }
        }
        @media (max-width: 400px) {
            .workout-date { flex-direction: column; align-items: flex-start; gap: 6px; }
            .exercise-name-row { flex-direction: column; align-items: flex-start; gap: 3px; }
            .metrics { flex-direction: column; gap: 12px; }
            .workout-actions { top: 10px; right: 10px; }
            .workout-date { padding-right: 80px; }
        }
    /* –ê–≤—Ç–æ—Ä–∞—Å—Ç—è–≥–∏–≤–∞—é—â–∏–π—Å—è textarea –¥–ª—è –ø—Ä–∏–º–µ—á–∞–Ω–∏–π */
/* ========== –ê–í–¢–û–†–ê–°–¢–Ø–ì–ò–í–ê–Æ–©–ò–ô–°–Ø TEXTAREA ========== */
.exercise-note-input {
    width: 100%;
    min-height: 38px;
    max-height: 200px;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: #fff;
    font-size: 0.95rem;
    font-family: 'Segoe UI', system-ui, sans-serif;
    resize: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ—Å–∞–π–∑–µ—Ä */
    overflow-y: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
    line-height: 1.4;
    transition: border-color 0.2s, background 0.2s;
    box-sizing: border-box; /* –í–∞–∂–Ω–æ! */
}

.exercise-note-input:focus {
    outline: none;
    border-color: #00b4d8;
    background: rgba(255, 255, 255, 0.15);
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .exercise-note-input {
        font-size: 16px; /* –£–±–∏—Ä–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
        min-height: 44px;
    }
    
    /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ */
    .exercises-table td[data-label="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"] {
        padding-top: 12px;
        padding-bottom: 12px;
    }
}

/* –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
.exercise-note-input:hover {
    border-color: rgba(255, 255, 255, 0.5);
}
/* ========== –°–¢–ò–õ–ò –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–û–î–•–û–î–ê–ú–ò ========== */
.weight-set-row {
    display: flex;
    gap: 8px;
    align-items: flex-start;
    margin-bottom: 8px;
    position: relative;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ (–ù–û–í–û–ï) */
.weight-set-buttons {
    display: flex;
    gap: 4px;
    align-self: flex-start;
}

/* –í—Å–µ –∏–Ω–ø—É—Ç—ã –≤ —Ä—è–¥—É –ø–æ–¥—Ö–æ–¥–∞ */
.weight-set-input,
.sets-input,
.reps-input {
    align-self: flex-start;
    height: 36px;
    margin-top: 0;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    color: #fff;
    font-size: 0.95rem;
    box-sizing: border-box;
}

.weight-set-input:focus,
.sets-input:focus,
.reps-input:focus {
    outline: none;
    border-color: #00b4d8;
    background: rgba(255, 255, 255, 0.15);
}

.weight-set-input {
    flex: 2;
    min-width: 120px;
}

.sets-input, .reps-input {
    flex: 1;
    min-width: 70px;
}

/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–∞–º–∏ */
.btn-add-weight-set,
.btn-remove-weight-set {
    align-self: flex-start;
    width: 34px;
    height: 34px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
    font-size: 0.85rem;
    flex-shrink: 0;
    margin-top: 0;
}

.btn-add-weight-set {
    background: rgba(72, 187, 120, 0.2);
    color: #c6f6d5;
    border-color: rgba(72, 187, 120, 0.4);
}

.btn-add-weight-set:hover {
    background: rgba(72, 187, 120, 0.4);
    transform: translateY(-1px);
}

.btn-remove-weight-set {
    background: rgba(220, 53, 69, 0.2);
    color: #f8a5a5;
    border-color: rgba(220, 53, 69, 0.4);
}

.btn-remove-weight-set:hover {
    background: rgba(220, 53, 69, 0.4);
    transform: translateY(-1px);
}

/* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —É –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ */
.weight-set-row[data-set-index="0"] .btn-remove-weight-set {
    display: none !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .weight-set-row {
        flex-wrap: wrap;
        align-items: flex-start;
    }
    
    .weight-set-input,
    .sets-input,
    .reps-input {
        min-width: calc(33.333% - 20px);
        flex: 1;
        height: 40px;
    }
    
    .weight-set-buttons {
        width: 100%;
        justify-content: flex-start;
        margin-top: 8px;
    }
    
    .btn-add-weight-set,
    .btn-remove-weight-set {
        width: 40px;
        height: 40px;
        font-size: 0.9rem;
    }
}
@media (max-width: 768px) {
    .order-buttons {
        flex-direction: row;
        justify-content: center;
    }
    
    .btn-move-up,
    .btn-move-down,
    .btn-remove-row {
        width: 30px;
        height: 30px;
        font-size: 0.75rem;
    }
    
    .btn-remove-row {
        margin-top: 0;
        margin-left: 4px;
    }
}

/* –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
@media (min-width: 1024px) {
    .order-buttons {
        flex-direction: row;
        gap: 6px;
    }
    
    .btn-remove-row {
        margin-top: 0;
    }
}
/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–∞–º–∏ */
.btn-add-weight-set, .btn-remove-weight-set {
    width: 36px;
    height: 36px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
    font-size: 0.9rem;
    flex-shrink: 0;
}

.btn-add-weight-set {
    background: rgba(72, 187, 120, 0.2);
    color: #c6f6d5;
    border-color: rgba(72, 187, 120, 0.4);
}

.btn-add-weight-set:hover {
    background: rgba(72, 187, 120, 0.4);
    transform: translateY(-1px);
}

.btn-remove-weight-set {
    background: rgba(220, 53, 69, 0.2);
    color: #f8a5a5;
    border-color: rgba(220, 53, 69, 0.4);
    margin-right: 4px;
}

.btn-remove-weight-set:hover {
    background: rgba(220, 53, 69, 0.4);
    transform: translateY(-1px);
}

/* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —É –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ */
.weight-set-row[data-set-index="0"] .btn-remove-weight-set {
    display: none !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .weight-set-row {
        flex-wrap: wrap;
    }
    
    .weight-set-input,
    .sets-input,
    .reps-input {
        min-width: calc(33.333% - 20px);
        flex: 1;
    }
    
    .btn-add-weight-set,
    .btn-remove-weight-set {
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
    }
}
/* ========== –ï–î–ò–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –í–°–ï–• –ü–û–õ–ï–ô –í –¢–ê–ë–õ–ò–¶–ï –£–ü–†–ê–ñ–ù–ï–ù–ò–ô ========== */
.exercises-table input,
.exercises-table select,
.exercises-table textarea {
    width: 100%;
    min-height: 38px;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: #fff;
    font-size: 0.95rem;
    font-family: inherit;
    box-sizing: border-box;
    transition: all 0.2s;
}

.exercises-table input:focus,
.exercises-table select:focus,
.exercises-table textarea:focus {
    outline: none;
    border-color: #00b4d8;
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 0 0 2px rgba(0, 180, 216, 0.1);
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–∞ */
.exercise-name-select {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 35px;
    cursor: pointer;
}

.exercise-name-select:hover {
    border-color: rgba(255, 255, 255, 0.5);
}

/* –ü–æ–ª—è –≤ –ø–æ–¥—Ö–æ–¥–∞—Ö (—É–∂–µ –µ—Å—Ç—å, –Ω–æ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏) */
.weight-set-input,
.sets-input,
.reps-input {
    height: 38px;
}

/* –î–ª—è textarea –ø—Ä–∏–º–µ—á–∞–Ω–∏–π (—É–∂–µ –µ—Å—Ç—å, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç –∑–¥–µ—Å—å) */
.exercise-note-input {
    resize: none;
    overflow-y: hidden;
    line-height: 1.4;
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
@media (max-width: 768px) {
    .exercises-table input,
    .exercises-table select {
        font-size: 16px; /* –£–±–∏—Ä–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
    }
    
    .exercise-name-select {
        background-position: right 10px center;
    }
}
/* ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–ê–ù–ù–ï–† –û–§–õ–ê–ô–ù-–†–ï–ñ–ò–ú–ê ========== */
.offline-warning {
    display: none;
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.9), rgba(238, 90, 82, 0.9));
    color: white;
    padding: 10px 15px;
    text-align: center;
    font-weight: bold;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 25; /* –£–ú–ï–ù–¨–®–ò–õ–ò —Å 9999 –¥–æ 100 */
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Å —Ä–∞–∑–º—ã—Ç–∏–µ–º */
    -webkit-backdrop-filter: blur(5px);
    pointer-events: none; /* –ë–∞–Ω–Ω–µ—Ä –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏ */
}

.offline .offline-warning {
    display: block;
}

/* –ö–Ω–æ–ø–∫–∞ "+" –ø–æ–≤–µ—Ä—Ö –±–∞–Ω–Ω–µ—Ä–∞ */
.header-add-btn {
    position: relative; /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ */
    z-index: 101; /* –í–´–®–ï —á–µ–º –±–∞–Ω–Ω–µ—Ä */
    /* –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ */
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ç–∏ –≤ —à–∞–ø–∫–µ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π) */
.app-header::after {
    content: '';
    position: absolute;
    top: 16px; /* –ü–æ–¥—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ –≤–∞—à—É —à–∞–ø–∫—É */
    right: 60px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #48bb78; /* –ó–µ–ª–µ–Ω—ã–π - –æ–Ω–ª–∞–π–Ω */
    transition: all 0.3s;
    z-index: 102; /* –°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –ø–æ–∑–∏—Ü–∏—è */
}

.offline .app-header::after {
    background-color: #ff6b6b; /* –ö—Ä–∞—Å–Ω—ã–π - –æ—Ñ–ª–∞–π–Ω */
}

/* –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏ - –æ–Ω–∞ –º–æ–∂–µ—Ç –æ—Ç–≤–ª–µ–∫–∞—Ç—å */
@keyframes pulse {
    0% { opacity: 0.7; }
    50% { opacity: 1; }
    100% { opacity: 0.7; }
}

/* –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç - –Ω–æ —Å –≤–∏–¥–∏–º—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º */
.offline #exportAllBtn,
.offline #importBtn,
.offline #exportReportBtn {
    opacity: 0.5;
    pointer-events: none;
    position: relative;
}

.offline #exportAllBtn::after,
.offline #importBtn::after,
.offline #exportReportBtn::after {
    content: ' (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)';
    font-size: 0.8em;
    opacity: 0.7;
}
	</style>
</head>
<body>
    <!-- –®–ê–ü–ö–ê -->
    <header class="app-header">
        <div class="header-titles">
            <h1 id="pageTitle">üèãÔ∏è –ú–æ–π –î–Ω–µ–≤–Ω–∏–∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
            <div class="subtitle" id="pageSubtitle">–°–∏–ª–∞ –≤ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ. –ü—Ä–æ–≥—Ä–µ—Å—Å –≤ –¥–µ—Ç–∞–ª—è—Ö.</div>
        </div>
        <button class="header-add-btn" id="globalAddBtn" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É">+</button>
    </header>
<div class="offline-warning" id="offlineWarning">
    <i class="fas fa-wifi-slash"></i> –í—ã –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.
</div>	
    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <main class="content-area">
        <!-- –í–ö–õ–ê–î–ö–ê –î–ù–ï–í–ù–ò–ö–ê -->
        <section id="workoutSection">
            <div class="workout-list" id="workoutListContainer">
                <div class="empty-state" id="workoutEmptyState">
                    <i class="fas fa-dumbbell"></i>
                    <h3>–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "+" –≤ —à–∞–ø–∫–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É!</p>
                </div>
            </div>
        </section>

        <!-- –í–ö–õ–ê–î–ö–ê –£–ü–†–ê–ñ–ù–ï–ù–ò–ô -->
        <section id="exercisesSection" style="display: none;">
            <div class="exercises-card">
                <h2><i class="fas fa-list-check"></i> –ú–æ—è –±–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</h2>
                <p style="color: #aaa; margin-bottom: 20px; font-size: 0.95rem;">
                    –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—é–¥–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ.
                </p>
                <form class="exercise-form" id="exerciseForm">
                    <div class="input-with-button">
                        <input type="text" id="newExerciseInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è..." required>
                        <button type="submit" class="btn-add"><i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </form>
                <div class="exercises-list-container">
                    <ul class="exercises-list" id="exercisesList">
                        <li class="empty-list-message" id="emptyExercisesList">
                            <i class="fas fa-dumbbell"></i>
                            <strong>–ë–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –ø—É—Å—Ç–∞</strong><br>
                            –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- –í–ö–õ–ê–î–ö–ê –ü–†–û–§–ò–õ–Ø -->
        <section id="profileSection" style="display: none;">
            <div class="profile-card">
                <h2><i class="fas fa-user-circle"></i> –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
                <form class="profile-form" id="profileForm">
                    <div class="form-group">
                        <label for="profileUserName">–í–∞—à–µ –∏–º—è *</label>
                        <input type="text" id="profileUserName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ò–≤–∞–Ω" required>
                    </div>
                    <div class="form-group">
                        <label for="profileUserBirthDate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                        <input type="text" id="profileUserBirthDate" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" required>
                        <div class="hint">–§–æ—Ä–º–∞—Ç: –¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥</div>
                    </div>
                    <div class="form-group">
                        <label for="profileUserHeight">–†–æ—Å—Ç (—Å–º) *</label>
                        <input type="number" id="profileUserHeight" placeholder="166" min="100" max="250" step="0.1" required>
                        <div class="hint">–î–ª—è —Ä–∞—Å—á—ë—Ç–∞ BMI</div>
                    </div>
                    <button type="submit" class="btn-save"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                </form>
            </div>
            
            <!-- –ù–û–í–´–ô –ë–õ–û–ö: –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• -->
            <div class="profile-card" style="margin-top: 15px;">
                <h2><i class="fas fa-file-export"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h2>
                <p style="color: #aaa; margin-bottom: 20px; font-size: 0.95rem;">
                    –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON-—Ñ–∞–π–ª –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.
                </p>
                
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px;">
                    <button class="btn-export" id="exportAllBtn">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    
                  <button class="btn-import" id="importBtn">
   					 <i class="fas fa-upload"></i> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω)
				</button>
                 
		    <button class="btn-export" id="exportReportBtn" style="background: linear-gradient(135deg, #00b4d8, #0077b6);">
       			<i class="fas fa-file-alt"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
   		    </button>   
                
		    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                </div>
                
                <div class="hint" style="color: #ffd166; background: rgba(255, 209, 102, 0.1); padding: 10px; border-radius: 8px; font-size: 0.85rem;">
                    <strong><i class="fas fa-info-circle"></i> –í–∞–∂–Ω–æ:</strong> –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã. 
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
                </div>
            </div>
            
            <div class="graph-container">
                <h3><i class="fas fa-chart-line"></i> –î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞</h3>
                <div id="weightChart">
                    <!-- –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í –ü–ï–†–ò–û–î–ê -->
                    <div class="graph-controls">
                        <div class="period-filters">
                            <button class="period-btn active" data-period="all">–í—Å—ë –≤—Ä–µ–º—è</button>
                            <button class="period-btn" data-period="year">–ì–æ–¥</button>
                            <button class="period-btn" data-period="3month">3 –º–µ—Å—è—Ü–∞</button>
                            <button class="period-btn" data-period="30days">30 –¥–Ω–µ–π</button>
                        </div>
                        <div class="extremes-info" id="extremesInfo" style="display: none;">
                            <span class="extremes-min"><i class="fas fa-arrow-down"></i> –ú–∏–Ω: <span id="extremeMinValue">-</span> –∫–≥</span>
                            <span class="extremes-max"><i class="fas fa-arrow-up"></i> –ú–∞–∫—Å: <span id="extremeMaxValue">-</span> –∫–≥</span>
                        </div>
                    </div>
                    
                    <div class="graph-placeholder" id="chartPlaceholder">
                        <i class="fas fa-weight-scale" style="font-size: 2.5rem; margin-bottom: 10px; opacity: 0.5;"></i><br>
                        <strong>–î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</strong><br>
                        –î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–µ—Å–∞.
                    </div>
                    <canvas id="weightChartCanvas"></canvas>
                </div>
            </div>
        </section>

       
 <!-- –í–ö–õ–ê–î–ö–ê –¢–ê–ô–ú–ï–†–ê -->
        <section id="timerSection" style="display: none;">
            <div class="timer-card">
                <h2><i class="fas fa-stopwatch"></i> –°–µ–∫—É–Ω–¥–æ–º–µ—Ä</h2>
                
        <!-- –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£ –î–õ–Ø –î–ò–°–ü–õ–ï–Ø –¢–ê–ô–ú–ï–†–ê -->
        <div class="timer-display" id="timerDisplay">00:00</div>
                              
                <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
                <div class="timer-controls">
                    <button class="timer-btn timer-btn-start" id="startPauseBtn">
                        <i class="fas fa-play"></i> –°—Ç–∞—Ä—Ç
                    </button>
                    <button class="timer-btn timer-btn-lap" id="lapBtn" disabled>
                        <i class="fas fa-flag"></i> –ö—Ä—É–≥
                    </button>
                    <button class="timer-btn timer-btn-reset" id="resetBtn" disabled>
                        <i class="fas fa-redo"></i> –°–±—Ä–æ—Å
                    </button>
                </div>
                
                <!-- –°–ü–ò–°–û–ö –ö–†–£–ì–û–í -->
                <div class="timer-laps">
                    <h3><i class="fas fa-list-ol"></i> –ö—Ä—É–≥–∏</h3>
                    <div class="laps-container" id="lapsContainer">
                        <div class="empty-laps" id="emptyLaps">
                            <i class="fas fa-flag"></i><br>
                            <strong>–ö—Ä—É–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</strong><br>
                            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ö—Ä—É–≥" –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞.
                        </div>
                    </div>
                </div>
                
                <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
                <div class="timer-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="totalLaps">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∫—Ä—É–≥–æ–≤</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="fastestLap">--:--</div>
                        <div class="stat-label">–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∫—Ä—É–≥</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="slowestLap">--:--</div>
                        <div class="stat-label">–°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –∫—Ä—É–≥</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- –§–û–†–ú–ê –¢–†–ï–ù–ò–†–û–í–ö–ò -->
    <div class="form-overlay" id="newWorkoutFormOverlay">
        <div class="form-container">
            <div class="form-header">
                <h2><i class="fas fa-plus-circle"></i> <span id="formTitle">–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span></h2>
                <button class="btn-close-form" id="closeFormBtn">&times;</button>
            </div>
            <form class="workout-form" id="newWorkoutForm">
                <input type="hidden" id="workoutId" value="">
                <input type="hidden" id="isEditMode" value="false">
                
                <div class="form-section">
                    <h3><i class="far fa-calendar"></i> –î–∞—Ç–∞ –∏ —Ç–∏–ø</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="workoutDate">–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ *</label>
                            <input type="text" id="workoutDate" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" required>
                            <div class="hint">–§–æ—Ä–º–∞—Ç: –¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥</div>
                        </div>
                        <div class="form-group">
                            <label for="workoutType">–¢–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ *</label>
                            <select id="workoutType" required>
                                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                                <option value="strength">–°–∏–ª–æ–≤–∞—è –≤ –∑–∞–ª–µ</option>
                                <option value="circuit">–ö—Ä—É–≥–æ–≤–∞—è</option>
                                <option value="home">–î–æ–º–∞—à–Ω—è—è</option>
                                <option value="other">–î—Ä—É–≥–æ–µ (—É–∫–∞–∑–∞—Ç—å)</option>
                            </select>
                            <input type="text" id="workoutTypeOther" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç" style="margin-top: 10px; display: none;">
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h3><i class="fas fa-dumbbell"></i> –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
                    <table class="exercises-table" id="exercisesTable">
                        <thead>
                            <tr>
                                <th style="width: 30%;">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</th>
                                <th style="width: 20%;">–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è</th>
                                <th style="width: 35%;">–í–µ—Å/–ü–æ–¥—Ö–æ–¥—ã</th>
                                <th style="width: 10%;">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                                <th style="width: 5%;"></th>
                            </tr>
                        </thead>
                        <tbody id="exercisesTableBody">
                        </tbody>
                    </table>
                    <button type="button" class="btn-add-exercise" id="addExerciseRowBtn">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                    </button>
                </div>
                <div class="form-section">
                    <h3><i class="fas fa-swimming-pool"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="extraActivityType">–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
                            <select id="extraActivityType">
                                <option value="" selected>–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                                <option value="–ë–∞—Å—Å–µ–π–Ω (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞)">–ë–∞—Å—Å–µ–π–Ω (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞)</option>
                                <option value="–ë–∞—Å—Å–µ–π–Ω (—Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–ª–∞–≤–∞–Ω–∏–µ)">–ë–∞—Å—Å–µ–π–Ω (—Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–ª–∞–≤–∞–Ω–∏–µ)</option>
                                <option value="other">–î—Ä—É–≥–æ–µ...</option>
                            </select>
                            <input type="text" id="extraActivityOther" placeholder="–û–ø–∏—à–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å" style="margin-top: 10px; display: none;">
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h3><i class="fas fa-weight-scale"></i> –í–µ—Å –∏ –ò–Ω–¥–µ–∫—Å BMI</h3>
                    <div class="weight-bmi-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="workoutWeight">–í–µ—Å –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–∫–≥)</label>
                            <input type="number" id="workoutWeight" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 70.0" step="0.1" min="30" max="200">
                            <div class="hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –≤–∑–≤–µ—à–∏–≤–∞–ª–∏—Å—å.</div>
                        </div>
                        <div class="bmi-display">
                            <div class="bmi-value" id="bmiValue">-</div>
                            <div class="bmi-label">–ò–Ω–¥–µ–∫—Å BMI</div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" id="cancelFormBtn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-submit"><i class="fas fa-save"></i> <span id="submitButtonText">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</span></button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ò–ú–ü–û–†–¢–ê -->
    <div class="import-modal" id="importModal">
        <div class="import-modal-content">
            <div class="form-header">
                <h2><i class="fas fa-file-import"></i> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <button class="btn-close-form" id="closeImportModal">&times;</button>
            </div>
            
            <div id="importSummary" style="display: none;">
                <div style="background: rgba(255, 209, 102, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #ffd166; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:</h3>
                    <div id="importStats" style="color: #ccc;"></div>
                </div>
            </div>
            
            <div class="import-options">
                <div class="import-option">
                    <input type="radio" id="importOptionFull" name="importOption" value="full" checked>
                    <label for="importOptionFull">–ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç (–∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)</label>
                    <div class="hint">–ó–∞–º–µ–Ω—è–µ—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ.</div>
                </div>
                
                <div class="import-option">
                    <input type="radio" id="importOptionMerge" name="importOption" value="merge">
                    <label for="importOptionMerge">–û–±—ä–µ–¥–∏–Ω–∏—Ç—å (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)</label>
                    <div class="hint">–î–æ–±–∞–≤–∏—Ç –Ω–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ.</div>
                </div>
                
                <div class="import-option">
                    <input type="radio" id="importOptionExercises" name="importOption" value="exercises">
                    <label for="importOptionExercises">–¢–æ–ª—å–∫–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
                    <div class="hint">–û–±–Ω–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.</div>
                </div>
            </div>
            
            <div class="form-actions" style="margin-top: 30px;">
                <button type="button" class="btn-cancel" id="cancelImportBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn-submit" id="confirmImportBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–º–ø–æ—Ä—Ç</button>
            </div>
        </div>
    </div>

    <!-- –ú–ï–ù–Æ -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-target="workoutSection">
            <i class="fas fa-dumbbell"></i><span>–î–Ω–µ–≤–Ω–∏–∫</span>
        </a>
        <a href="#" class="nav-item" data-target="exercisesSection">
            <i class="fas fa-list-check"></i><span>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</span>
        </a>
        <a href="#" class="nav-item" data-target="profileSection">
            <i class="fas fa-user-circle"></i><span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
        <a href="#" class="nav-item" data-target="timerSection">
            <i class="fas fa-stopwatch"></i><span>–¢–∞–π–º–µ—Ä</span>
        </a>
    </nav>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>

    <!-- –°–ö–†–ò–ü–¢ -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ PWA –∏ –æ—Ñ–ª–∞–π–Ω-—Ä–∞–±–æ—Ç—ã
if ('serviceWorker' in navigator && 'caches' in window) {
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
  navigator.serviceWorker.register('service-worker.js')
    .then(registration => {
      console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ–ª–∞–π–Ω
      window.addEventListener('online', () => {
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω');
        document.documentElement.classList.remove('offline');
      });
      
      window.addEventListener('offline', () => {
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ñ–ª–∞–π–Ω');
        document.documentElement.classList.add('offline');
        showNotification('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ', true);
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
      if (!navigator.onLine) {
        document.documentElement.classList.add('offline');
        showNotification('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ', true);
      }
      
    })
    .catch(error => {
      console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
    });
} else {
  console.warn('PWA –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º');
}
		// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const STORAGE_KEYS = {
            PROFILE: 'workoutDiary_userProfile',
            WORKOUTS: 'workoutDiary_workoutLog',
            EXERCISES: 'workoutDiary_exerciseBase',
            ACTIVE_TAB: 'workoutDiary_activeTab',
            TIMER_STATE: 'workoutTimer_state'
        };
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤–µ—Ä—Å–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
        const DATA_FORMAT_VERSION = '1.0';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let exerciseRowCounter = 0;
        let weightChart = null;
        
// ==================== –¢–ê–ô–ú–ï–† ====================
let timerInterval = null;
let isRunning = false;
let laps = [];
let currentLapStartTime = 0;
let currentLapElapsedTime = 0;
let wakeLock = null; // ‚Üê –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£

// –≠–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–π–º–µ—Ä–∞
const timerDisplay = document.getElementById('timerDisplay');
const startPauseBtn = document.getElementById('startPauseBtn');
const lapBtn = document.getElementById('lapBtn');
const resetBtn = document.getElementById('resetBtn');
const lapsContainer = document.getElementById('lapsContainer');
const emptyLaps = document.getElementById('emptyLaps');
const totalLapsEl = document.getElementById('totalLaps');
const fastestLapEl = document.getElementById('fastestLap');
const slowestLapEl = document.getElementById('slowestLap');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ Wake Lock (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–Ω–∞ —ç–∫—Ä–∞–Ω–∞)
async function requestWakeLock() {
    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Wake Lock API
        if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request('screen');
            console.log('Wake Lock –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω - —ç–∫—Ä–∞–Ω –Ω–µ –±—É–¥–µ—Ç –≥–∞—Å–Ω—É—Ç—å');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è Wake Lock
            wakeLock.addEventListener('release', () => {
                console.log('Wake Lock –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω');
            });
        }
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ Wake Lock:', err);
        // –ï—Å–ª–∏ Wake Lock –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è Wake Lock
function releaseWakeLock() {
    if (wakeLock !== null) {
        wakeLock.release();
        wakeLock = null;
        console.log('Wake Lock –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω –≤—Ä—É—á–Ω—É—é');
    }
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Wake Lock –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('visibilitychange', async () => {
    if (document.visibilityState === 'visible' && isRunning && wakeLock === null) {
        // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–Ω–æ–≤–∞ —Å—Ç–∞–ª–∞ –≤–∏–¥–∏–º–æ–π, —Ç–∞–π–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ Wake Lock –±—ã–ª –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω
        await requestWakeLock();
    }
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
function updateTimerDisplay() {
    const currentLapTime = currentLapElapsedTime + (isRunning ? Date.now() - currentLapStartTime : 0);
    const minutes = Math.floor((currentLapTime / 60000) % 60);
    const seconds = Math.floor((currentLapTime / 1000) % 60);
    
    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫—Ä—É–≥–∞
function formatLapTime(ms) {
    const minutes = Math.floor((ms / 60000) % 60);
    const seconds = Math.floor((ms / 1000) % 60);
    
    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫—Ä—É–≥–æ–≤
function renderLaps() {
    const container = document.getElementById('lapsContainer');
    
    // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫—Ä—É–≥–∏
    const existingLaps = container.querySelectorAll('.lap-item');
    existingLaps.forEach(lap => lap.remove());
    
    if (laps.length === 0) {
        if (emptyLaps) emptyLaps.style.display = 'block';
        return;
    }
    
    if (emptyLaps) emptyLaps.style.display = 'none';
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫—Ä—É–≥–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–≤–µ—Ä—Ö—É)
    for (let i = laps.length - 1; i >= 0; i--) {
        const lap = laps[i];
        const lapItem = document.createElement('div');
        lapItem.className = 'lap-item';
        lapItem.innerHTML = `
            <div class="lap-number">#${i + 1}</div>
            <div class="lap-time">${formatLapTime(lap.time)}</div>
        `;
        container.appendChild(lapItem);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
    totalLapsEl.textContent = laps.length;
    
    if (laps.length > 0) {
        const lapTimes = laps.map(lap => lap.time);
        const fastest = Math.min(...lapTimes);
        const slowest = Math.max(...lapTimes);
        
        fastestLapEl.textContent = formatLapTime(fastest);
        slowestLapEl.textContent = formatLapTime(slowest);
    } else {
        fastestLapEl.textContent = '--:--';
        slowestLapEl.textContent = '--:--';
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ (—Å—Ç–∞—Ä—Ç/–ø–∞—É–∑–∞)
async function toggleTimer() {
    if (isRunning) {
        // –ü–∞—É–∑–∞
        clearInterval(timerInterval);
        const now = Date.now();
        currentLapElapsedTime += now - currentLapStartTime;
        startPauseBtn.innerHTML = '<i class="fas fa-play"></i> –°—Ç–∞—Ä—Ç';
        lapBtn.disabled = true;
        resetBtn.disabled = false;
        
        // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º Wake Lock –ø—Ä–∏ –ø–∞—É–∑–µ
        releaseWakeLock();
    } else {
        // –°—Ç–∞—Ä—Ç
        currentLapStartTime = Date.now();
        timerInterval = setInterval(updateTimerDisplay, 10);
        startPauseBtn.innerHTML = '<i class="fas fa-pause"></i> –ü–∞—É–∑–∞';
        lapBtn.disabled = false;
        resetBtn.disabled = true;
        
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º Wake Lock –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        await requestWakeLock();
    }
    
    isRunning = !isRunning;
    saveTimerState();
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—Ä—É–≥–∞
function addLap() {
    if (!isRunning) return;
    
    const now = Date.now();
    const lapTime = currentLapElapsedTime + (now - currentLapStartTime);
    
    laps.push({
        time: lapTime,
        timestamp: now
    });
    
    // –û–±–Ω—É–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∫—Ä—É–≥
    currentLapElapsedTime = 0;
    currentLapStartTime = now;
    
    renderLaps();
    updateStats();
    updateTimerDisplay();
    saveTimerState();
}

// –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
function resetTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    currentLapElapsedTime = 0;
    currentLapStartTime = 0;
    laps = [];
    
    startPauseBtn.innerHTML = '<i class="fas fa-play"></i> –°—Ç–∞—Ä—Ç';
    lapBtn.disabled = true;
    resetBtn.disabled = true;
    
    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º Wake Lock –ø—Ä–∏ —Å–±—Ä–æ—Å–µ
    releaseWakeLock();
    
    updateTimerDisplay();
    renderLaps();
    updateStats();
    saveTimerState();
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
function saveTimerState() {
    const state = {
        isRunning: isRunning,
        currentLapStartTime: currentLapStartTime,
        currentLapElapsedTime: currentLapElapsedTime,
        laps: laps,
        savedAt: Date.now()
    };
    
    try {
        localStorage.setItem(STORAGE_KEYS.TIMER_STATE, JSON.stringify(state));
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
function loadTimerState() {
    try {
        const saved = localStorage.getItem(STORAGE_KEYS.TIMER_STATE);
        if (saved) {
            const state = JSON.parse(saved);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ (–±–æ–ª—å—à–µ 24 —á–∞—Å–æ–≤)
            const now = Date.now();
            const savedAt = state.savedAt || 0;
            const hoursSinceSave = (now - savedAt) / (1000 * 60 * 60);
            
            if (hoursSinceSave < 24) {
                isRunning = state.isRunning || false;
                currentLapStartTime = state.currentLapStartTime || 0;
                currentLapElapsedTime = state.currentLapElapsedTime || 0;
                laps = state.laps || [];
                
                if (isRunning) {
                    // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –±—ã–ª –∑–∞–ø—É—â–µ–Ω, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
                    const timeSincePause = now - currentLapStartTime;
                    currentLapElapsedTime += timeSincePause;
                    currentLapStartTime = now;
                    
                    timerInterval = setInterval(updateTimerDisplay, 10);
                    startPauseBtn.innerHTML = '<i class="fas fa-pause"></i> –ü–∞—É–∑–∞';
                    lapBtn.disabled = false;
                    resetBtn.disabled = true;
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Wake Lock
                    requestWakeLock();
                } else {
                    startPauseBtn.innerHTML = '<i class="fas fa-play"></i> –°—Ç–∞—Ä—Ç';
                    lapBtn.disabled = true;
                    resetBtn.disabled = laps.length > 0;
                }
                
                updateTimerDisplay();
                renderLaps();
                updateStats();
            } else {
                // –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
                resetTimer();
            }
        }
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞:', e);
    }
}

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, isSuccess = true) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.backgroundColor = isSuccess ? 'rgba(72, 187, 120, 0.9)' : 'rgba(220, 53, 69, 0.9)';
            notif.style.display = 'block';
            setTimeout(() => { notif.style.display = 'none'; }, 4000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–ø–∫–∏
        function updateHeader(activeTab) {
            const titles = {
                'workoutSection': { title: 'üèãÔ∏è –ú–æ–π –î–Ω–µ–≤–Ω–∏–∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', subtitle: '–°–∏–ª–∞ –≤ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ. –ü—Ä–æ–≥—Ä–µ—Å—Å –≤ –¥–µ—Ç–∞–ª—è—Ö.' },
                'exercisesSection': { title: 'üìù –ë–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π', subtitle: '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π.' },
                'profileSection': { title: 'üìä –ü—Ä–æ—Ñ–∏–ª—å –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', subtitle: '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å.' },
                'timerSection': { title: '‚è±Ô∏è –¢–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', subtitle: '–°–µ–∫—É–Ω–¥–æ–º–µ—Ä —Å –∫—Ä—É–≥–∞–º–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.' }
            };
            const config = titles[activeTab] || titles['workoutSection'];
            document.getElementById('pageTitle').textContent = config.title;
            
            const subtitle = document.getElementById('pageSubtitle');
            subtitle.textContent = config.subtitle;
            
            // –ò–∑–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –î–Ω–µ–≤–Ω–∏–∫
            if (activeTab === 'workoutSection') {
                subtitle.classList.add('diary-subtitle');
            } else {
                subtitle.classList.remove('diary-subtitle');
            }
        }

        // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        function getCurrentDateFormatted() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            return `${day}.${month}.${year}`;
        }

        // ==================== –†–ê–ë–û–¢–ê –° –¢–†–ï–ù–ò–†–û–í–ö–ê–ú–ò ====================

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        function loadWorkoutLog() {
            try {
                const saved = localStorage.getItem(STORAGE_KEYS.WORKOUTS);
                return saved ? JSON.parse(saved) : [];
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:', error);
                return [];
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        function saveWorkoutLog(workouts) {
            try {
                localStorage.setItem(STORAGE_KEYS.WORKOUTS, JSON.stringify(workouts));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', false);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID
        function generateWorkoutId() {
            return 'w_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏
        function getDayOfWeek(dateStr) {
            const days = ['–í–°', '–ü–ù', '–í–¢', '–°–†', '–ß–¢', '–ü–¢', '–°–ë'];
            const parts = dateStr.split('.');
            if (parts.length !== 3) return '';
            const date = new Date(parts[2], parts[1] - 1, parts[0]);
            return days[date.getDay()];
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Å–∞/–ø–æ–¥—Ö–æ–¥–æ–≤
        function formatWeightSets(weightSets) {
            if (!weightSets || weightSets.length === 0) return '';
            return weightSets.map(set => {
                const parts = [];
                if (set.weight) parts.push(set.weight);
                if (set.sets && set.reps) parts.push(`${set.sets}x${set.reps} —Ä–∞–∑`);
                return parts.join(' ');
            }).join('\n');
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        function renderWorkoutList() {
            const container = document.getElementById('workoutListContainer');
            const emptyState = document.getElementById('workoutEmptyState');
            const workouts = loadWorkoutLog();
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            const existingCards = container.querySelectorAll('.workout-card');
            existingCards.forEach(card => card.remove());
            
            if (workouts.length === 0) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                if (emptyState && !container.contains(emptyState)) {
                    container.appendChild(emptyState);
                }
                if (emptyState) emptyState.style.display = 'block';
                return;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (emptyState) emptyState.style.display = 'none';
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            workouts.sort((a, b) => {
                const dateA = new Date(a.date.split('.').reverse().join('-'));
                const dateB = new Date(b.date.split('.').reverse().join('-'));
                return dateB - dateA;
            });
            
            workouts.forEach(workout => {
                const card = createWorkoutCard(workout);
                container.appendChild(card);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function createWorkoutCard(workout) {
            const card = document.createElement('article');
            card.className = 'workout-card';
            card.dataset.type = workout.type;
            card.dataset.id = workout.id;
            
            // –¢–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            const typeConfig = {
                strength: { name: '–°–∏–ª–æ–≤–∞—è –≤ –∑–∞–ª–µ', class: 'type-strength' },
                circuit: { name: '–ö—Ä—É–≥–æ–≤–∞—è', class: 'type-circuit' },
                home: { name: '–î–æ–º–∞—à–Ω—è—è', class: 'type-home' },
                other: { name: workout.type, class: 'type-other' }
            };

            // –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ö–õ–Æ–ß–ê –î–õ–Ø –¢–ò–ü–ê
            let typeKey = workout.type;
            if (!['strength', 'circuit', 'home'].includes(workout.type)) {
                typeKey = 'other';
            }

            const typeInfo = typeConfig[typeKey] || { name: workout.type, class: 'type-other' };

            // –î–ª—è —Ç–∏–ø–∞ "other" –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ,
            // –Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º data-type="other" –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ —Ä–∞–º–∫–∏
            if (typeKey === 'other') {
                typeInfo.name = workout.type;
                card.dataset.type = 'other';
            }

            // –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏
            const dayOfWeek = getDayOfWeek(workout.date);
            
            card.innerHTML = `
                <div class="workout-date">
                    <div class="date-text">
                        ${workout.date} <span style="color:#ccc;">(${dayOfWeek})</span>
                        <button class="workout-copy-btn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É"><i class="far fa-copy"></i></button>
                    </div>
                    <div class="workout-type ${typeInfo.class}">${typeInfo.name}</div>
                </div>
                <div class="workout-actions">
                    <button class="workout-edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å"><i class="fas fa-pencil-alt"></i></button>
                    <button class="workout-delete-btn" title="–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å"><i class="fas fa-trash-alt"></i></button>
                </div>
                <div class="workout-body">
                    <div class="exercises-block">
                        ${workout.exercises.map((ex, i) => `
                            <div class="exercise-item">
                                <div class="exercise-name-row">
                                    <div class="exercise-main-name"><span class="exercise-number">${i+1}.</span> ${ex.name}</div>
                                    ${ex.spec ? `<div class="exercise-spec">${ex.spec}</div>` : ''}
                                </div>
                                ${ex.weightSets && ex.weightSets.length > 0 ? `
                                    <div class="weight-details">${formatWeightSets(ex.weightSets)}</div>
                                ` : ''}
                                ${ex.note ? `<div class="exercise-note">${ex.note}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    ${workout.extraActivity ? `
                        <div class="extra-activity">
                            <strong><i class="fas fa-swimming-pool"></i> –î–æ–ø. –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> ${workout.extraActivity}
                        </div>
                    ` : ''}
                    ${workout.weight ? `
                        <div class="metrics">
                            <div class="metric"><div class="metric-value">${workout.weight}</div><div class="metric-label">–í–µ—Å (–∫–≥)</div></div>
                            <div class="metric"><div class="metric-value">${workout.bmi || '-'}</div><div class="metric-label">–ò–Ω–¥–µ–∫—Å BMI</div></div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            card.querySelector('.workout-copy-btn').addEventListener('click', () => copyWorkout(workout.id));
            card.querySelector('.workout-edit-btn').addEventListener('click', () => editWorkout(workout.id));
            card.querySelector('.workout-delete-btn').addEventListener('click', () => deleteWorkout(workout.id));
            
            return card;
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function copyWorkout(workoutId) {
            const workouts = loadWorkoutLog();
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout) {
                showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', false);
                return;
            }
            
            const copiedWorkout = JSON.parse(JSON.stringify(workout));
            copiedWorkout.id = generateWorkoutId();
            copiedWorkout.date = getCurrentDateFormatted();
            copiedWorkout.created = Date.now();
            
            openEditWorkoutForm(copiedWorkout, true);
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.');
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function editWorkout(workoutId) {
            const workouts = loadWorkoutLog();
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout) {
                showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', false);
                return;
            }
            
            openEditWorkoutForm(workout, false);
            showNotification('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function deleteWorkout(workoutId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) return;
            
            const workouts = loadWorkoutLog();
            const filtered = workouts.filter(w => w.id !== workoutId);
            
            if (filtered.length === workouts.length) {
                showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', false);
                return;
            }
            
            saveWorkoutLog(filtered);
            renderWorkoutList();
            updateWeightChart();
            showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
        }

        // ==================== –§–û–†–ú–ê –¢–†–ï–ù–ò–†–û–í–ö–ò ====================

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—ã
        function openNewWorkoutForm() {
            resetForm();
            document.getElementById('formTitle').textContent = '–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞';
            document.getElementById('submitButtonText').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
            document.getElementById('workoutId').value = '';
            document.getElementById('isEditMode').value = 'false';
            document.getElementById('workoutDate').value = getCurrentDateFormatted();
            addNewExerciseRow();
            showForm();
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        function openEditWorkoutForm(workout, isCopy) {
            resetForm();
            
            if (isCopy) {
                document.getElementById('formTitle').textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏';
                document.getElementById('submitButtonText').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–ø–∏—é';
            } else {
                document.getElementById('formTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏';
                document.getElementById('submitButtonText').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            }
            
            document.getElementById('workoutId').value = workout.id;
            document.getElementById('isEditMode').value = isCopy ? 'false' : 'true';
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π
            document.getElementById('workoutDate').value = workout.date;
            
            // –¢–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            let workoutType = workout.type;
            let workoutTypeOther = '';
            if (!['strength', 'circuit', 'home'].includes(workoutType)) {
                workoutType = 'other';
                workoutTypeOther = workout.type;
            }
            document.getElementById('workoutType').value = workoutType;
            if (workoutType === 'other') {
                document.getElementById('workoutTypeOther').value = workoutTypeOther;
                document.getElementById('workoutTypeOther').style.display = 'block';
            }
            
            // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            if (workout.exercises && workout.exercises.length > 0) {
                addNewExerciseRow();
                
                for (let i = 1; i < workout.exercises.length; i++) {
                    addNewExerciseRow();
                }
                
                document.querySelectorAll('#exercisesTableBody tr').forEach((row, index) => {
                    if (workout.exercises[index]) {
                        fillExerciseRow(row, workout.exercises[index]);
                    }
                });
            } else {
                addNewExerciseRow();
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            if (workout.extraActivity === '–ë–∞—Å—Å–µ–π–Ω (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞)' || workout.extraActivity === '–ë–∞—Å—Å–µ–π–Ω (—Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–ª–∞–≤–∞–Ω–∏–µ)') {
                document.getElementById('extraActivityType').value = workout.extraActivity;
            } else if (workout.extraActivity) {
                document.getElementById('extraActivityType').value = 'other';
                document.getElementById('extraActivityOther').value = workout.extraActivity;
                document.getElementById('extraActivityOther').style.display = 'block';
            }
            
            // –í–µ—Å –∏ BMI
            if (workout.weight) {
                document.getElementById('workoutWeight').value = workout.weight;
                updateBmiDisplay();
            }
            
            showForm();
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function fillExerciseRow(row, exercise) {
            const select = row.querySelector('.exercise-name-select');
            const otherInput = row.querySelector('.exercise-name-other');
            const exercises = loadExercises();
            
            const exerciseInBase = exercises.find(ex => ex === exercise.name);
            if (exerciseInBase) {
                select.value = exercise.name;
                otherInput.style.display = 'none';
            } else {
                select.value = '_other_';
                otherInput.style.display = 'block';
                otherInput.value = exercise.name;
            }
            
   // –î–ª—è –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
const specInput = row.querySelector('.exercise-spec-input');
if (specInput) {
    specInput.value = exercise.spec || '';
    if (specInput.tagName === 'TEXTAREA') {
        setTimeout(() => {
            specInput.style.height = 'auto';
            specInput.style.height = (specInput.scrollHeight) + 'px';
        }, 10);
    }
}

// –î–ª—è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
const noteInput = row.querySelector('.exercise-note-input');
if (noteInput) {
    noteInput.value = exercise.note || '';
    setTimeout(() => {
        noteInput.style.height = 'auto';
        noteInput.style.height = (noteInput.scrollHeight) + 'px';
    }, 10);
}
            
const container = row.querySelector('.weight-sets-container');
if (container) {
    container.innerHTML = '';
    
    if (exercise.weightSets && exercise.weightSets.length > 0) {
        exercise.weightSets.forEach((set, setIndex) => {
            const setRow = document.createElement('div');
            setRow.className = 'weight-set-row';
            setRow.dataset.setIndex = setIndex;
            
            // –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
            const removeButtonHtml = setIndex === 0 ? '' : 
                `<button type="button" class="btn-remove-weight-set" onclick="window.removeWeightSet('${row.id}', ${setIndex})" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–¥—Ö–æ–¥">
                    <i class="fas fa-trash"></i>
                </button>`;
            
            setRow.innerHTML = `
                <input type="text" class="weight-set-input" placeholder="–í–µ—Å" value="${set.weight || ''}">
                <input type="number" class="sets-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã" value="${set.sets || ''}" min="1" max="20">
                <input type="number" class="reps-input" placeholder="–†–∞–∑" value="${set.reps || ''}" min="1" max="100">
                <div class="weight-set-buttons">
                    ${removeButtonHtml}
                    <button type="button" class="btn-add-weight-set" onclick="window.addWeightSet('${row.id}')" title="–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–¥—Ö–æ–¥">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            `;
            container.appendChild(setRow);
        });
    } else {
        // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥–æ–≤, —Å–æ–∑–¥–∞—ë–º –æ–¥–∏–Ω –ø—É—Å—Ç–æ–π
        const setRow = document.createElement('div');
        setRow.className = 'weight-set-row';
        setRow.dataset.setIndex = 0;
        setRow.innerHTML = `
            <input type="text" class="weight-set-input" placeholder="–í–µ—Å">
            <input type="number" class="sets-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1" max="20">
            <input type="number" class="reps-input" placeholder="–†–∞–∑" min="1" max="100">
            <div class="weight-set-buttons">
                <button type="button" class="btn-add-weight-set" onclick="window.addWeightSet('${row.id}')" title="–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–¥—Ö–æ–¥">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        `;
        container.appendChild(setRow);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(() => updateWeightSetIndexes(row.id), 50);
}
        }

        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        function resetForm() {
            document.getElementById('newWorkoutForm').reset();
            document.getElementById('exercisesTableBody').innerHTML = '';
            exerciseRowCounter = 0;
            document.getElementById('workoutTypeOther').style.display = 'none';
            document.getElementById('extraActivityOther').style.display = 'none';
            document.getElementById('bmiValue').textContent = '-';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É
        function showForm() {
            document.getElementById('newWorkoutFormOverlay').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // –ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
        function closeForm() {
            document.getElementById('newWorkoutFormOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
function addNewExerciseRow() {
    const tbody = document.getElementById('exercisesTableBody');
    const exercises = loadExercises();
    const rowId = `exerciseRow_${exerciseRowCounter++}`;
    
    const row = document.createElement('tr');
    row.id = rowId;
    row.dataset.exerciseIndex = tbody.children.length; // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å
    
    let optionsHtml = '<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ...</option>';
    exercises.forEach(ex => {
        optionsHtml += `<option value="${ex}">${ex}</option>`;
    });
    optionsHtml += '<option value="_other_">–î—Ä—É–≥–æ–µ (–≤–≤–µ—Å—Ç–∏)</option>';
    
    row.innerHTML = `
        <td data-label="–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">
            <select class="exercise-name-select" style="width: 100%;" onchange="window.handleExerciseSelectChange(this, '${rowId}')">
                ${optionsHtml}
            </select>
            <input type="text" class="exercise-name-other" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" style="margin-top: 8px; display: none;">
        </td>
        <td data-label="–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è">
    <textarea class="exercise-spec-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —à–∏—Ä–æ–∫–∏–π —Ö–≤–∞—Ç" rows="1"></textarea>
</td>
        <td data-label="–í–µ—Å/–ü–æ–¥—Ö–æ–¥—ã">
            <div class="weight-sets-container">
                <div class="weight-set-row" data-set-index="0">
                    <input type="text" class="weight-set-input" placeholder="–í–µ—Å">
                    <input type="number" class="sets-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1" max="20">
                    <input type="number" class="reps-input" placeholder="–†–∞–∑" min="1" max="100">
                    <div class="weight-set-buttons">
                        <button type="button" class="btn-add-weight-set" onclick="window.addWeightSet('${rowId}')" title="–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–¥—Ö–æ–¥">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        </td>
        <td data-label="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ">
            <textarea class="exercise-note-input" placeholder="–ó–∞–º–µ—Ç–∫–∞..." rows="1"></textarea>
        </td>
        <td class="exercise-row-actions" data-label="–î–µ–π—Å—Ç–≤–∏—è">
            <div class="order-buttons">
                <button type="button" class="btn-move-up" onclick="moveExerciseUp('${rowId}')" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–≤–µ—Ä—Ö">
                    <i class="fas fa-arrow-up"></i>
                </button>
                <button type="button" class="btn-move-down" onclick="moveExerciseDown('${rowId}')" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤–Ω–∏–∑">
                    <i class="fas fa-arrow-down"></i>
                </button>
                <button type="button" class="btn-remove-row" onclick="removeExerciseRow('${rowId}')" title="–£–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </td>
    `;
    
    tbody.appendChild(row);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞–≤—Ç–æ-–≤—ã—Å–æ—Ç—ã –¥–ª—è textarea
    const textarea = row.querySelector('.exercise-note-input');
    if (textarea) {
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    }
    // –ê–≤—Ç–æ-–≤—ã—Å–æ—Ç–∞ –¥–ª—è –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–∫–∞–∫ –¥–ª—è –ü—Ä–∏–º–µ—á–∞–Ω–∏–π)
const specTextarea = row.querySelector('.exercise-spec-input');
if (specTextarea) {
    specTextarea.addEventListener('input', autoResizeTextarea);
    setTimeout(() => autoResizeTextarea.call(specTextarea), 10);
}
    return rowId;
}
// –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ-–≤—ã—Å–æ—Ç—ã –¥–ª—è textarea
function autoResizeTextarea() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
}
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function handleExerciseSelectChange(select, rowId) {
            const row = document.getElementById(rowId);
            if (!row) return;
            
            const otherInput = row.querySelector('.exercise-name-other');
            if (select.value === '_other_') {
                otherInput.style.display = 'block';
                otherInput.required = true;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ –≤–µ—Å–∞/–ø–æ–¥—Ö–æ–¥–æ–≤
function addWeightSet(rowId) {
    const row = document.getElementById(rowId);
    if (!row) return;
    
    const container = row.querySelector('.weight-sets-container');
    if (!container) return;
    
    // –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤ —É–∂–µ –µ—Å—Ç—å
    const existingSets = container.querySelectorAll('.weight-set-row');
    const newIndex = existingSets.length;
    
    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥
    const setRow = document.createElement('div');
    setRow.className = 'weight-set-row';
    setRow.dataset.setIndex = newIndex;
    
    // –î–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
    const removeButtonHtml = newIndex === 0 ? '' : 
        `<button type="button" class="btn-remove-weight-set" onclick="window.removeWeightSet('${rowId}', ${newIndex})" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–¥—Ö–æ–¥">
            <i class="fas fa-trash"></i>
        </button>`;
    
    setRow.innerHTML = `
        <input type="text" class="weight-set-input" placeholder="–í–µ—Å">
        <input type="number" class="sets-input" placeholder="–ü–æ–¥—Ö–æ–¥—ã" min="1" max="20">
        <input type="number" class="reps-input" placeholder="–†–∞–∑" min="1" max="100">
        <div class="weight-set-buttons">
            ${removeButtonHtml}
            <button type="button" class="btn-add-weight-set" onclick="window.addWeightSet('${rowId}')" title="–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–¥—Ö–æ–¥">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    `;
    
    container.appendChild(setRow);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –≤—Å–µ—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
    updateWeightSetIndexes(rowId);
}
function removeWeightSet(rowId, setIndex) {
    const row = document.getElementById(rowId);
    if (!row) return;
    
    const container = row.querySelector('.weight-sets-container');
    if (!container) return;
    
    // –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    const setToRemove = container.querySelector(`.weight-set-row[data-set-index="${setIndex}"]`);
    if (!setToRemove) return;
    
    // –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥
    const firstSet = container.querySelector('.weight-set-row[data-set-index="0"]');
    if (setToRemove === firstSet) {
        showNotification('–ü–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥ –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å', false);
        return;
    }
    
    // –£–¥–∞–ª—è–µ–º –ø–æ–¥—Ö–æ–¥
    setToRemove.remove();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø–æ–¥—Ö–æ–¥–æ–≤
    updateWeightSetIndexes(rowId);
    
    showNotification('–ü–æ–¥—Ö–æ–¥ —É–¥–∞–ª—ë–Ω');
}

function updateWeightSetIndexes(rowId) {
    const row = document.getElementById(rowId);
    if (!row) return;
    
    const container = row.querySelector('.weight-sets-container');
    if (!container) return;
    
    const allSets = container.querySelectorAll('.weight-set-row');
    
    allSets.forEach((set, index) => {
        set.dataset.setIndex = index;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        const buttonsContainer = set.querySelector('.weight-set-buttons');
        if (buttonsContainer) {
            const removeBtn = buttonsContainer.querySelector('.btn-remove-weight-set');
            const addBtn = buttonsContainer.querySelector('.btn-add-weight-set');
            
            if (removeBtn) {
                removeBtn.setAttribute('onclick', `window.removeWeightSet('${rowId}', ${index})`);
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —É –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
                removeBtn.style.display = index === 0 ? 'none' : 'flex';
            }
            if (addBtn) {
                addBtn.setAttribute('onclick', `window.addWeightSet('${rowId}')`);
            }
        }
    });
}
		
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function removeExerciseRow(rowId) {
            const row = document.getElementById(rowId);
            if (!row) return;
            
            if (document.querySelectorAll('#exercisesTableBody tr').length > 1) {
                row.remove();
            } else {
                // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –µ—ë
                const inputs = row.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (input.type !== 'button') {
                        input.value = '';
                    }
                });
            }
        }
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
function moveExerciseUp(rowId) {
    console.log('moveExerciseUp –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è:', rowId); // ‚Üê –î–æ–±–∞–≤–∏—Ç—å
	const row = document.getElementById(rowId);
    if (!row) return;
    
    const tbody = document.getElementById('exercisesTableBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const currentIndex = rows.indexOf(row);
    
    // –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—ã—à–µ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    if (currentIndex <= 0) {
        showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞–≤–µ—Ä—Ö—É', false);
        return;
    }
    
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º
    const prevRow = rows[currentIndex - 1];
    tbody.insertBefore(row, prevRow);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
    updateExerciseIndexes();
    showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤–≤–µ—Ä—Ö');
}

function moveExerciseDown(rowId) {
    const row = document.getElementById(rowId);
    if (!row) return;
    
    const tbody = document.getElementById('exercisesTableBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const currentIndex = rows.indexOf(row);
    
    // –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∏–∂–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏
    if (currentIndex >= rows.length - 1) {
        showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–∏–∑—É', false);
        return;
    }
    
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º
    const nextRow = rows[currentIndex + 1];
    if (nextRow.nextSibling) {
        tbody.insertBefore(row, nextRow.nextSibling);
    } else {
        tbody.appendChild(row);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
    updateExerciseIndexes();
    showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤–Ω–∏–∑');
}

function updateExerciseIndexes() {
    const tbody = document.getElementById('exercisesTableBody');
    const rows = tbody.querySelectorAll('tr');
    
    rows.forEach((row, index) => {
        row.dataset.exerciseIndex = index;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
        // –ò—â–µ–º –Ω–æ–º–µ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–µ - –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
        const numberSpans = row.querySelectorAll('.exercise-number');
        numberSpans.forEach(span => {
            span.textContent = `${index + 1}.`;
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º onclick –∞—Ç—Ä–∏–±—É—Ç—ã –∫–Ω–æ–ø–æ–∫
        const moveUpBtn = row.querySelector('.btn-move-up');
        const moveDownBtn = row.querySelector('.btn-move-down');
        const removeBtn = row.querySelector('.btn-remove-row');
        
        if (moveUpBtn) {
            moveUpBtn.setAttribute('onclick', `window.moveExerciseUp('${row.id}')`);
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–≤–≤–µ—Ä—Ö" –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
            moveUpBtn.disabled = (index === 0);
        }
        if (moveDownBtn) {
            moveDownBtn.setAttribute('onclick', `window.moveExerciseDown('${row.id}')`);
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–≤–Ω–∏–∑" –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏
            moveDownBtn.disabled = (index === rows.length - 1);
        }
        if (removeBtn) {
            removeBtn.setAttribute('onclick', `window.removeExerciseRow('${row.id}')`);
        }
    });
}
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ BMI
        function updateBmiDisplay() {
            const weight = parseFloat(document.getElementById('workoutWeight').value);
            const profile = loadProfile();
            
            if (!weight || !profile || !profile.height) {
                document.getElementById('bmiValue').textContent = '-';
                return;
            }
            
            const heightInMeters = profile.height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            document.getElementById('bmiValue').textContent = bmi.toFixed(1);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        function handleWorkoutFormSubmit(event) {
            event.preventDefault();
            
            const workoutId = document.getElementById('workoutId').value;
            const isEditMode = document.getElementById('isEditMode').value === 'true';
            const workouts = loadWorkoutLog();
            
            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
            const workoutDate = document.getElementById('workoutDate').value;
            let workoutType = document.getElementById('workoutType').value;
            if (workoutType === 'other') {
                workoutType = document.getElementById('workoutTypeOther').value.trim() || '–î—Ä—É–≥–æ–µ';
            }
            
            // –°–±–æ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
            const exercises = [];
            document.querySelectorAll('#exercisesTableBody tr').forEach(row => {
                const nameSelect = row.querySelector('.exercise-name-select');
                const otherInput = row.querySelector('.exercise-name-other');
                let exerciseName = '';
                
                if (nameSelect.value === '_other_') {
                    exerciseName = otherInput.value.trim();
                } else {
                    exerciseName = nameSelect.value;
                }
                
                if (!exerciseName) return;
                
                const exercise = {
                    name: exerciseName,
                    spec: row.querySelector('.exercise-spec-input').value.trim(),
                    note: row.querySelector('.exercise-note-input').value.trim(),
                    weightSets: []
                };
                
                // –°–±–æ—Ä –Ω–∞–±–æ—Ä–æ–≤ –≤–µ—Å–∞/–ø–æ–¥—Ö–æ–¥–æ–≤
                row.querySelectorAll('.weight-set-row').forEach(setRow => {
                    const weight = setRow.querySelector('.weight-set-input').value.trim();
                    const sets = setRow.querySelector('.sets-input').value;
                    const reps = setRow.querySelector('.reps-input').value;
                    
                    if (weight || sets || reps) {
                        exercise.weightSets.push({
                            weight: weight || '',
                            sets: sets || '',
                            reps: reps || ''
                        });
                    }
                });
                
                exercises.push(exercise);
            });
            
            if (exercises.length === 0) {
                showNotification('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', false);
                return;
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            let extraActivity = document.getElementById('extraActivityType').value;
            if (extraActivity === 'other') {
                extraActivity = document.getElementById('extraActivityOther').value.trim() || '';
            } else if (extraActivity === '') {
                extraActivity = null;
            }
            
            // –í–µ—Å –∏ BMI
            const weight = document.getElementById('workoutWeight').value ? 
                parseFloat(document.getElementById('workoutWeight').value) : null;
            const bmi = weight ? parseFloat(document.getElementById('bmiValue').textContent) : null;
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            const workout = {
                id: isEditMode ? workoutId : generateWorkoutId(),
                date: workoutDate,
                type: workoutType,
                exercises: exercises,
                extraActivity: extraActivity,
                weight: weight,
                bmi: bmi,
                created: isEditMode ? workouts.find(w => w.id === workoutId)?.created || Date.now() : Date.now()
            };
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            if (isEditMode) {
                const index = workouts.findIndex(w => w.id === workoutId);
                if (index !== -1) {
                    workouts[index] = workout;
                }
            } else {
                workouts.push(workout);
            }
            
            saveWorkoutLog(workouts);
            renderWorkoutList();
            updateWeightChart();
            closeForm();
            
            showNotification(isEditMode ? '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
        }

        // ==================== –ë–ê–ó–ê –£–ü–†–ê–ñ–ù–ï–ù–ò–ô ====================

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function loadExercises() {
            try {
                const saved = localStorage.getItem(STORAGE_KEYS.EXERCISES);
                return saved ? JSON.parse(saved) : [];
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:', error);
                return [];
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function saveExercises(exercises) {
            try {
                localStorage.setItem(STORAGE_KEYS.EXERCISES, JSON.stringify(exercises));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π', false);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function renderExercisesList() {
            const list = document.getElementById('exercisesList');
            const emptyMsg = document.getElementById('emptyExercisesList');
            const exercises = loadExercises();
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞
            const existingItems = list.querySelectorAll('.exercise-list-item');
            existingItems.forEach(item => item.remove());
            
            if (exercises.length === 0) {
                if (emptyMsg) emptyMsg.style.display = 'block';
                return;
            }
            
            if (emptyMsg) emptyMsg.style.display = 'none';
            
            exercises.forEach((exercise, index) => {
                const li = document.createElement('li');
                li.className = 'exercise-list-item';
                li.dataset.index = index;
                li.innerHTML = `
                    <span class="exercise-list-name">${exercise}</span>
                    <input type="text" class="exercise-list-edit-input" value="${exercise}">
                    <div class="exercise-list-actions">
                        <button class="btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><i class="fas fa-pencil-alt"></i></button>
                        <button class="btn-save-edit" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"><i class="fas fa-check"></i></button>
                        <button class="btn-cancel-edit" title="–û—Ç–º–µ–Ω–∞"><i class="fas fa-times"></i></button>
                        <button class="btn-delete" title="–£–¥–∞–ª–∏—Ç—å"><i class="fas fa-trash-alt"></i></button>
                    </div>
                `;
                list.appendChild(li);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                const editBtn = li.querySelector('.btn-edit');
                const saveBtn = li.querySelector('.btn-save-edit');
                const cancelBtn = li.querySelector('.btn-cancel-edit');
                const deleteBtn = li.querySelector('.btn-delete');
                const nameSpan = li.querySelector('.exercise-list-name');
                const editInput = li.querySelector('.exercise-list-edit-input');
                
                editBtn.addEventListener('click', function() {
                    nameSpan.classList.add('editing');
                    editInput.classList.add('editing');
                    editBtn.style.display = 'none';
                    saveBtn.style.display = 'inline-block';
                    cancelBtn.style.display = 'inline-block';
                    editInput.focus();
                    editInput.select();
                });
                
                saveBtn.addEventListener('click', function() {
                    const newName = editInput.value.trim();
                    if (!newName) {
                        showNotification('–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º', false);
                        return;
                    }
                    
                    exercises[index] = newName;
                    saveExercises(exercises);
                    renderExercisesList();
                    showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
                });
                
                cancelBtn.addEventListener('click', function() {
                    nameSpan.classList.remove('editing');
                    editInput.classList.remove('editing');
                    editBtn.style.display = 'inline-block';
                    saveBtn.style.display = 'none';
                    cancelBtn.style.display = 'none';
                    editInput.value = exercises[index];
                });
                
                deleteBtn.addEventListener('click', function() {
                    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ?')) return;
                    
                    exercises.splice(index, 1);
                    saveExercises(exercises);
                    renderExercisesList();
                    showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                });
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function addNewExercise(event) {
            event.preventDefault();
            const input = document.getElementById('newExerciseInput');
            const name = input.value.trim();
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', false);
                return;
            }
            
            const exercises = loadExercises();
            if (exercises.includes(name)) {
                showNotification('–¢–∞–∫–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ', false);
                return;
            }
            
            exercises.push(name);
            saveExercises(exercises);
            renderExercisesList();
            input.value = '';
            showNotification('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
        }

        // ==================== –ü–†–û–§–ò–õ–¨ ====================

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
        function loadProfile() {
            try {
                const saved = localStorage.getItem(STORAGE_KEYS.PROFILE);
                if (!saved) return null;
                
                const profile = JSON.parse(saved);
                
                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –ø—Ä–æ—Ñ–∏–ª—è
                const nameInput = document.getElementById('profileUserName');
                const birthDateInput = document.getElementById('profileUserBirthDate');
                const heightInput = document.getElementById('profileUserHeight');
                
                if (nameInput && profile.name) nameInput.value = profile.name;
                if (birthDateInput && profile.birthDate) birthDateInput.value = profile.birthDate;
                if (heightInput && profile.height) heightInput.value = profile.height;
                
                return profile;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
                return null;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        function saveProfile(event) {
            event.preventDefault();
            
            const name = document.getElementById('profileUserName').value.trim();
            const birthDate = document.getElementById('profileUserBirthDate').value.trim();
            const height = document.getElementById('profileUserHeight').value;
            
            if (!name || !birthDate || !height) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', false);
                return;
            }
            
            const profile = {
                name: name,
                birthDate: birthDate,
                height: parseFloat(height)
            };
            
            try {
                localStorage.setItem(STORAGE_KEYS.PROFILE, JSON.stringify(profile));
                showNotification('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è', false);
            }
        }



        // ==================== –ì–†–ê–§–ò–ö –í–ï–°–ê ====================

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø–µ—Ä–∏–æ–¥–æ–≤
        const PERIOD_MS = {
            '30days': 30 * 24 * 60 * 60 * 1000,
            '3month': 90 * 24 * 60 * 60 * 1000,
            'year': 365 * 24 * 60 * 60 * 1000,
            'all': null
        };

        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
        let currentChartPeriod = 'all';

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        function loadChartPeriod() {
            try {
                const saved = localStorage.getItem('workoutDiary_chartPeriod');
                if (saved && PERIOD_MS.hasOwnProperty(saved)) {
                    return saved;
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–∏–æ–¥–∞:', e);
            }
            return 'all';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
        function saveChartPeriod(period) {
            try {
                localStorage.setItem('workoutDiary_chartPeriod', period);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞:', e);
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–µ—Ä–∏–æ–¥—É
        function filterWeightDataByPeriod(weightData, period) {
            if (period === 'all' || !PERIOD_MS[period]) {
                return weightData;
            }
            
            const now = new Date();
            const periodStart = new Date(now.getTime() - PERIOD_MS[period]);
            
            return weightData.filter(item => {
                try {
                    const parts = item.date.split('.');
                    if (parts.length !== 3) return false;
                    const itemDate = new Date(parts[2], parts[1] - 1, parts[0]);
                    return itemDate >= periodStart && itemDate <= now;
                } catch (e) {
                    return false;
                }
            });
        }

        // –ü–æ–∏—Å–∫ —ç–∫—Å—Ç—Ä–µ–º—É–º–æ–≤
        function findExtremes(weightData) {
            if (weightData.length === 0) {
                return { min: null, max: null };
            }
            
            let minIndex = 0;
            let maxIndex = 0;
            
            for (let i = 1; i < weightData.length; i++) {
                if (weightData[i].weight < weightData[minIndex].weight) {
                    minIndex = i;
                }
                if (weightData[i].weight > weightData[maxIndex].weight) {
                    maxIndex = i;
                }
            }
            
            return {
                min: {
                    index: minIndex,
                    date: weightData[minIndex].date,
                    weight: weightData[minIndex].weight
                },
                max: {
                    index: maxIndex,
                    date: weightData[maxIndex].date,
                    weight: weightData[maxIndex].weight
                }
            };
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –æ—Å–∏ X
        function formatDateLabel(dateStr, index, allLabels) {
            const parts = dateStr.split('.');
            if (parts.length !== 3) return dateStr;
            
            if (allLabels.length > 30) {
                return `${parts[0]}.${parts[1]}`;
            }
            if (allLabels.length > 14) {
                if (index % 7 === 0 || index === allLabels.length - 1) {
                    return `${parts[0]}.${parts[1]}.${parts[2].slice(2)}`;
                }
                return `${parts[0]}.${parts[1]}`;
            }
            return dateStr;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —ç–∫—Å—Ç—Ä–µ–º—É–º–∞—Ö
        function updateExtremesInfo(extremes) {
            const infoDiv = document.getElementById('extremesInfo');
            const minSpan = document.getElementById('extremeMinValue');
            const maxSpan = document.getElementById('extremeMaxValue');
            
            if (!extremes.min || !extremes.max) {
                infoDiv.style.display = 'none';
                return;
            }
            
            minSpan.textContent = extremes.min.weight.toFixed(1);
            maxSpan.textContent = extremes.max.weight.toFixed(1);
            infoDiv.style.display = 'flex';
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function updateWeightChart() {
            const workouts = loadWorkoutLog();
            const allWeightData = [];
            
            workouts.forEach(workout => {
                if (workout.date && workout.weight && !isNaN(parseFloat(workout.weight))) {
                    const weight = parseFloat(workout.weight);
                    if (weight > 30 && weight < 200) {
                        allWeightData.push({
                            date: workout.date,
                            weight: weight
                        });
                    }
                }
            });
            
            allWeightData.sort((a, b) => {
                const dateA = new Date(a.date.split('.').reverse().join('-'));
                const dateB = new Date(b.date.split('.').reverse().join('-'));
                return dateA - dateB;
            });
            
            const placeholder = document.getElementById('chartPlaceholder');
            const canvas = document.getElementById('weightChartCanvas');
            const period = currentChartPeriod;
            
            const filteredData = filterWeightDataByPeriod(allWeightData, period);
            
            if (filteredData.length < 2) {
                placeholder.style.display = 'block';
                canvas.style.display = 'none';
                if (weightChart) {
                    weightChart.destroy();
                    weightChart = null;
                }
                document.getElementById('extremesInfo').style.display = 'none';
                return;
            }
            
            placeholder.style.display = 'none';
            canvas.style.display = 'block';
            
            const labels = filteredData.map(item => item.date);
            const weights = filteredData.map(item => item.weight);
            
            const extremes = findExtremes(filteredData);
            updateExtremesInfo(extremes);
            
            const minData = new Array(filteredData.length).fill(null);
            const maxData = new Array(filteredData.length).fill(null);
            
            if (extremes.min) {
                minData[extremes.min.index] = extremes.min.weight;
            }
            if (extremes.max) {
                maxData[extremes.max.index] = extremes.max.weight;
            }
            
            const ctx = canvas.getContext('2d');
            
            if (weightChart) {
                weightChart.destroy();
            }
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–í–µ—Å (–∫–≥)',
                            data: weights,
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 7
                        },
                        {
                            label: '–ú–∏–Ω–∏–º—É–º',
                            data: minData,
                            type: 'scatter',
                            pointBackgroundColor: '#48bb78',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 8,
                            pointHoverRadius: 12,
                            showLine: false
                        },
                        {
                            label: '–ú–∞–∫—Å–∏–º—É–º',
                            data: maxData,
                            type: 'scatter',
                            pointBackgroundColor: '#ff6b6b',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 8,
                            pointHoverRadius: 12,
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.y;
                                    
                                    if (label === '–ú–∏–Ω–∏–º—É–º') {
                                        return `–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å: ${value.toFixed(1)} –∫–≥`;
                                    }
                                    if (label === '–ú–∞–∫—Å–∏–º—É–º') {
                                        return `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å: ${value.toFixed(1)} –∫–≥`;
                                    }
                                    return `–í–µ—Å: ${value.toFixed(1)} –∫–≥`;
                                },
                                afterLabel: function(context) {
                                    if (context.datasetIndex === 0) {
                                        const dataIndex = context.dataIndex;
                                        if (extremes.min && extremes.min.index === dataIndex) {
                                            return '(–ú–∏–Ω–∏–º—É–º –∑–∞ –ø–µ—Ä–∏–æ–¥)';
                                        }
                                        if (extremes.max && extremes.max.index === dataIndex) {
                                            return '(–ú–∞–∫—Å–∏–º—É–º –∑–∞ –ø–µ—Ä–∏–æ–¥)';
                                        }
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ccc',
                                callback: function(value) {
                                    return value + ' –∫–≥';
                                }
                            },
                            suggestedMin: Math.min(...weights) - 1,
                            suggestedMax: Math.max(...weights) + 1
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#ccc',
                                maxRotation: 45,
                                minRotation: 0,
                                callback: function(value, index) {
                                    return formatDateLabel(this.getLabelForValue(value), index, labels);
                                }
                            }
                        }
                    }
                }
            });
        }
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤
        function initPeriodFilters() {
            const buttons = document.querySelectorAll('.period-btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const period = this.dataset.period;
                    
                    buttons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentChartPeriod = period;
                    saveChartPeriod(period);
                    updateWeightChart();
                    
                    showNotification(`–ü–µ—Ä–∏–æ–¥ –≥—Ä–∞—Ñ–∏–∫–∞: ${this.textContent}`);
                });
            });
        }

        // ==================== –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ JSON (–°–ü–†–ò–ù–¢ 7) ====================

        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ JSON
  function exportAllData() {
    try {
        // –°–±–æ—Ä –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        const allData = {
            version: DATA_FORMAT_VERSION,
            exportedAt: new Date().toISOString(),
            dataFormat: 'workoutDiary_v1',
            workouts: loadWorkoutLog(),
            exercises: loadExercises(),
            profile: loadProfile(),
            timerState: JSON.parse(localStorage.getItem(STORAGE_KEYS.TIMER_STATE) || '{}'),
            chartPeriod: currentChartPeriod
        };
        
        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ JSON —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏
        const jsonData = JSON.stringify(allData, null, 2);
        
        // –°–æ–∑–¥–∞–Ω–∏–µ Blob –∏ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        const blob = new Blob([jsonData], { type: 'application/json' });
        
        // –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:
        if (navigator.onLine) {
            // –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ URL (—Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è Blob URL)
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workout_diary_backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            setTimeout(() => URL.revokeObjectURL(url), 100);
        } else {
            // –°–ø–æ—Å–æ–± 2: –û—Ñ–ª–∞–π–Ω-—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ FileSaver API (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            if (window.showSaveFilePicker) {
                // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
                window.showSaveFilePicker({
                    suggestedName: `workout_diary_backup_${new Date().toISOString().slice(0, 10)}.json`,
                    types: [{
                        description: 'JSON —Ñ–∞–π–ª—ã',
                        accept: { 'application/json': ['.json'] },
                    }],
                }).then(handle => {
                    const writable = handle.createWritable();
                    writable.write(blob);
                    writable.close();
                });
            } else {
                // –§–æ–ª–±—ç–∫: –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
                const dataUrl = 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonData);
                const a = document.createElement('a');
                a.href = dataUrl;
                a.download = `workout_diary_backup_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }
        
        showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã' + (navigator.onLine ? '' : ' (–æ—Ñ–ª–∞–π–Ω)'));
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', false);
    }
}

        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON
        function importDataFromFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const jsonData = event.target.result;
                        const importedData = JSON.parse(jsonData);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞
                        if (!importedData.dataFormat || !importedData.dataFormat.includes('workoutDiary')) {
                            reject(new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–µ–π –î–Ω–µ–≤–Ω–∏–∫–∞ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.'));
                            return;
                        }
                        
                        resolve(importedData);
                        
                    } catch (error) {
                        reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON-—Ñ–∞–π–ª–∞: ' + error.message));
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
                };
                
                reader.readAsText(file);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–¥–∫—É –∏–º–ø–æ—Ä—Ç–∞
        function showImportSummary(importedData) {
            const summaryDiv = document.getElementById('importSummary');
            const statsDiv = document.getElementById('importStats');
            
            if (!importedData) {
                summaryDiv.style.display = 'none';
                return;
            }
            
            let statsHTML = '<ul style="list-style: none; padding-left: 0;">';
            
            if (importedData.workouts && Array.isArray(importedData.workouts)) {
                statsHTML += `<li><i class="fas fa-dumbbell"></i> –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: <strong>${importedData.workouts.length}</strong></li>`;
            }
            
            if (importedData.exercises && Array.isArray(importedData.exercises)) {
                statsHTML += `<li><i class="fas fa-list-check"></i> –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: <strong>${importedData.exercises.length}</strong></li>`;
            }
            
            if (importedData.profile) {
                statsHTML += `<li><i class="fas fa-user-circle"></i> –ü—Ä–æ—Ñ–∏–ª—å: <strong>${importedData.profile.name || '–±–µ–∑ –∏–º–µ–Ω–∏'}</strong></li>`;
            }
            
            if (importedData.exportedAt) {
                const exportDate = new Date(importedData.exportedAt);
                statsHTML += `<li><i class="fas fa-calendar-alt"></i> –î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: <strong>${exportDate.toLocaleDateString('ru-RU')}</strong></li>`;
            }
            
            statsHTML += '</ul>';
            statsDiv.innerHTML = statsHTML;
            summaryDiv.style.display = 'block';
        }

        // –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
        function performImport(importedData, importOption) {
            try {
                const currentWorkouts = loadWorkoutLog();
                const currentExercises = loadExercises();
                const currentProfile = loadProfile();
                
                switch(importOption) {
                    case 'full':
                        // –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                        if (importedData.workouts) {
                            saveWorkoutLog(importedData.workouts);
                        }
                        if (importedData.exercises) {
                            saveExercises(importedData.exercises);
                        }
                        if (importedData.profile) {
                            localStorage.setItem(STORAGE_KEYS.PROFILE, JSON.stringify(importedData.profile));
                        }
                        if (importedData.timerState) {
                            localStorage.setItem(STORAGE_KEYS.TIMER_STATE, JSON.stringify(importedData.timerState));
                        }
                        if (importedData.chartPeriod) {
                            localStorage.setItem('workoutDiary_chartPeriod', importedData.chartPeriod);
                            currentChartPeriod = importedData.chartPeriod;
                        }
                        break;
                        
                    case 'merge':
                        // –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ ID)
                        if (importedData.workouts) {
                            const mergedWorkouts = [...currentWorkouts];
                            importedData.workouts.forEach(newWorkout => {
                                if (!mergedWorkouts.some(existing => existing.id === newWorkout.id)) {
                                    mergedWorkouts.push(newWorkout);
                                }
                            });
                            saveWorkoutLog(mergedWorkouts);
                        }
                        
                        // –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é)
                        if (importedData.exercises) {
                            const mergedExercises = [...currentExercises];
                            importedData.exercises.forEach(newExercise => {
                                if (!mergedExercises.some(existing => existing.toLowerCase() === newExercise.toLowerCase())) {
                                    mergedExercises.push(newExercise);
                                }
                            });
                            saveExercises(mergedExercises);
                        }
                        break;
                        
                    case 'exercises':
                        // –¢–æ–ª—å–∫–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞)
                        if (importedData.exercises) {
                            saveExercises(importedData.exercises);
                        }
                        break;
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                renderWorkoutList();
                renderExercisesList();
                updateWeightChart();
                loadProfile(); // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—è –ø—Ä–æ—Ñ–∏–ª—è
                
                showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                
                // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                closeImportModal();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, false);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞
        function showImportModal(importedData) {
            document.getElementById('importModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            showImportSummary(importedData);
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞
        function closeImportModal() {
            document.getElementById('importModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('importSummary').style.display = 'none';
            document.getElementById('importFileInput').value = '';
            
            // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            window.pendingImportData = null;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
        function initExportImport() {
            // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
            document.getElementById('exportAllBtn').addEventListener('click', exportAllData);
            
            // –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
            document.getElementById('importBtn').addEventListener('click', () => {
                document.getElementById('importFileInput').click();
            });
            
            // –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
            document.getElementById('importFileInput').addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.name.toLowerCase().endsWith('.json')) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ JSON-—Ñ–∞–π–ª', false);
                    return;
                }
                
                importDataFromFile(file)
                    .then(importedData => {
                        showImportModal(importedData);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                        window.pendingImportData = importedData;
                    })
                    .catch(error => {
                        showNotification(error.message, false);
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
                    });
            });
            
            // –ö–Ω–æ–ø–∫–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –∏–º–ø–æ—Ä—Ç–∞
            document.getElementById('closeImportModal').addEventListener('click', closeImportModal);
            document.getElementById('cancelImportBtn').addEventListener('click', closeImportModal);
            
            document.getElementById('confirmImportBtn').addEventListener('click', () => {
                const importOption = document.querySelector('input[name="importOption"]:checked').value;
                
                if (window.pendingImportData) {
                    performImport(window.pendingImportData, importOption);
                } else {
                    showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞', false);
                    closeImportModal();
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
            document.getElementById('importModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeImportModal();
                }
            });
        }

        // ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        function saveActiveTab(tabId) {
            try {
                sessionStorage.setItem(STORAGE_KEYS.ACTIVE_TAB, tabId);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        function loadActiveTab() {
            try {
                return sessionStorage.getItem(STORAGE_KEYS.ACTIVE_TAB) || 'workoutSection';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∫–ª–∞–¥–∫–∏:', error);
                return 'workoutSection';
            }
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏
            const activeTab = loadActiveTab();
            document.querySelectorAll('main section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(activeTab).style.display = 'block';
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.target === activeTab) {
                    item.classList.add('active');
                }
            });
            
            updateHeader(activeTab);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            loadProfile();
            renderExercisesList();
            renderWorkoutList();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
            currentChartPeriod = loadChartPeriod();
            initPeriodFilters();
            updateWeightChart();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
            loadTimerState();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
            initExportImport();
            
	    // –í—ã–∑–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–ª–æ–∫–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
	    initReportFunctionality();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.dataset.target;
                    
                    saveActiveTab(targetId);
                    
                    document.querySelectorAll('main section').forEach(section => {
                        section.style.display = 'none';
                    });
                    document.getElementById(targetId).style.display = 'block';
                    
                    document.querySelectorAll('.nav-item').forEach(navItem => {
                        navItem.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    updateHeader(targetId);
                    
                    if (targetId === 'profileSection') {
                        setTimeout(updateWeightChart, 100);
                    }
                    
                    if (targetId === 'workoutSection') {
                        renderWorkoutList();
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
                    if (isRunning) {
                        saveTimerState();
                    }
                });
            });
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('globalAddBtn').addEventListener('click', openNewWorkoutForm);
            
            // –§–æ—Ä–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            document.getElementById('closeFormBtn').addEventListener('click', closeForm);
            document.getElementById('cancelFormBtn').addEventListener('click', closeForm);
            document.getElementById('addExerciseRowBtn').addEventListener('click', addNewExerciseRow);
            document.getElementById('newWorkoutForm').addEventListener('submit', handleWorkoutFormSubmit);
            
            // –¢–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            document.getElementById('workoutType').addEventListener('change', function() {
                document.getElementById('workoutTypeOther').style.display = 
                    this.value === 'other' ? 'block' : 'none';
            });
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            document.getElementById('extraActivityType').addEventListener('change', function() {
                document.getElementById('extraActivityOther').style.display = 
                    this.value === 'other' ? 'block' : 'none';
            });
            
            // –í–µ—Å –¥–ª—è BMI
            document.getElementById('workoutWeight').addEventListener('input', updateBmiDisplay);
            
            // –ü—Ä–æ—Ñ–∏–ª—å
            document.getElementById('profileForm').addEventListener('submit', saveProfile);
            
            // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            document.getElementById('exerciseForm').addEventListener('submit', addNewExercise);
            
            // –¢–∞–π–º–µ—Ä
            startPauseBtn.addEventListener('click', toggleTimer);
            lapBtn.addEventListener('click', addLap);
            resetBtn.addEventListener('click', resetTimer);
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', function() {
                saveTimerState();
            });
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Ç–∞–π–º–µ—Ä–∞
            setInterval(function() {
                if (isRunning) {
                    saveTimerState();
                }
            }, 5000);
            
            // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
            const workouts = loadWorkoutLog();
            if (workouts.length === 0) {
                const demoAdded = localStorage.getItem('workoutDiary_demoAdded');
                if (!demoAdded) {
                    const demoExercises = [
                        '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è',
                        '–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª—ë–∂–∞',
                        '–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π',
                        '–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ',
                        '–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π —Å–∏–¥—è',
                        '–†–∞–∑–≤–æ–¥–∫–∞ –≥–∞–Ω—Ç–µ–ª–µ–π',
                        '–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º',
                        '–ü–æ–¥—ä—ë–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –±–∏—Ü–µ–ø—Å',
                        '–ü–æ–¥—ä—ë–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –±–∏—Ü–µ–ø—Å',
                        '–ì–∏–ø–µ—Ä—ç–∫—Å—Ç–µ–Ω–∑–∏—è'
                    ];
                    saveExercises(demoExercises);
                    
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const twoDaysAgo = new Date(today);
                    twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
                    
                    function formatDate(date) {
                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const year = date.getFullYear();
                        return `${day}.${month}.${year}`;
                    }
                    
                    const demoWorkouts = [
                        {
                            id: generateWorkoutId(),
                            date: formatDate(twoDaysAgo),
                            type: 'strength',
                            exercises: [
                                {
                                    name: '–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è',
                                    spec: '—à–∏—Ä–æ–∫–∏–π —Ö–≤–∞—Ç',
                                    weightSets: [
                                        { weight: '- (–≤–µ—Å —Ç–µ–ª–∞)', sets: '4', reps: '8' }
                                    ],
                                    note: '–•–æ—Ä–æ—à–∞—è —Ç–µ—Ö–Ω–∏–∫–∞'
                                },
                                {
                                    name: '–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ª—ë–∂–∞',
                                    spec: '—Å—Ä–µ–¥–Ω–∏–π —Ö–≤–∞—Ç',
                                    weightSets: [
                                        { weight: '60 –∫–≥', sets: '3', reps: '10' },
                                        { weight: '50 –∫–≥', sets: '2', reps: '12' }
                                    ],
                                    note: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–¥—Ö–æ–¥ —Ç—è–∂–µ–ª–æ'
                                }
                            ],
                            extraActivity: '–ë–∞—Å—Å–µ–π–Ω (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞)',
                            weight: 71.5,
                            bmi: 26.1,
                            created: Date.now() - 172800000
                        }
                    ];
                    
                    saveWorkoutLog(demoWorkouts);
                    localStorage.setItem('workoutDiary_demoAdded', 'true');
                    
                    renderWorkoutList();
                    renderExercisesList();
                    updateWeightChart();
                    
                    showNotification('–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }
            }
        });
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç—á–µ—Ç–∞
function showReportModal() {
    document.getElementById('reportModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –≤ –ø–æ–ª–µ "–î–∞—Ç–∞ –ø–æ"
    const today = new Date();
    const day = String(today.getDate()).padStart(2, '0');
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const year = today.getFullYear();
    document.getElementById('reportDateTo').value = `${day}.${month}.${year}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç—á–µ—Ç–∞
function closeReportModal() {
    document.getElementById('reportModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    document.getElementById('customDatesContainer').style.display = 'none';
}

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–µ—Ä–∏–æ–¥—É
function filterWorkoutsByPeriod(workouts, period, dateFrom, dateTo) {
    if (period === 'all') {
        return workouts;
    }
    
    const now = new Date();
    let startDate;
    
    switch(period) {
        case 'week':
            startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            break;
        case 'month':
            startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            break;
        case 'custom':
            if (!dateFrom || !dateTo) {
                return workouts;
            }
            try {
                const fromParts = dateFrom.split('.');
                const toParts = dateTo.split('.');
                startDate = new Date(fromParts[2], fromParts[1] - 1, fromParts[0]);
                const endDate = new Date(toParts[2], toParts[1] - 1, toParts[0]);
                
                return workouts.filter(workout => {
                    try {
                        const parts = workout.date.split('.');
                        const workoutDate = new Date(parts[2], parts[1] - 1, parts[0]);
                        return workoutDate >= startDate && workoutDate <= endDate;
                    } catch (e) {
                        return false;
                    }
                });
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç:', e);
                return workouts;
            }
    }
    
    // –î–ª—è –ø–µ—Ä–∏–æ–¥–æ–≤ week –∏ month
    return workouts.filter(workout => {
        try {
            const parts = workout.date.split('.');
            const workoutDate = new Date(parts[2], parts[1] - 1, parts[0]);
            return workoutDate >= startDate && workoutDate <= now;
        } catch (e) {
            return false;
        }
    });
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Å–∞/–ø–æ–¥—Ö–æ–¥–æ–≤ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
function formatWeightSetsForReport(weightSets) {
    if (!weightSets || weightSets.length === 0) return '';
    
    return weightSets.map(set => {
        const parts = [];
        if (set.weight) parts.push(set.weight);
        if (set.sets && set.reps) parts.push(`${set.sets}x${set.reps}`);
        return parts.join(' ');
    }).join(', ');
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
function generateTextReport(workouts, period) {
    let report = '';
    // –ú–ê–ü–ü–ò–ù–ì –¢–ò–ü–û–í –¢–†–ï–ù–ò–†–û–í–û–ö (–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫)
    const workoutTypeMapping = {
        'strength': '–°–∏–ª–æ–≤–∞—è –≤ –∑–∞–ª–µ',
        'circuit': '–ö—Ä—É–≥–æ–≤–∞—è',
        'home': '–î–æ–º–∞—à–Ω—è—è',
        'cardio': '–ö–∞—Ä–¥–∏–æ',
    	'yoga': '–ô–æ–≥–∞',
    	'stretching': '–†–∞—Å—Ç—è–∂–∫–∞',
    	'crossfit': '–ö—Ä–æ—Å—Å—Ñ–∏—Ç',
		'other': '–î—Ä—É–≥–æ–µ'
    };
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á–µ—Ç–∞
    report += '='.repeat(60) + '\n';
    report += '–û–¢–ß–ï–¢ –û –¢–†–ï–ù–ò–†–û–í–ö–ê–•\n';
    report += '='.repeat(60) + '\n\n';
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–∏–æ–¥–µ
    const periodNames = {
        'all': '–í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
        'week': '–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é',
        'month': '–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü',
        'custom': '–ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥'
    };
    
    report += `–ü–µ—Ä–∏–æ–¥: ${periodNames[period] || period}\n`;
    report += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${workouts.length}\n`;
    report += `–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleDateString('ru-RU')}\n`;
    report += '-'.repeat(60) + '\n\n';
    
    if (workouts.length === 0) {
        report += '–ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.\n';
        report += '='.repeat(60) + '\n';
        return report;
    }
    
    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–∞—Ç—ã)
    const sortedWorkouts = [...workouts].sort((a, b) => {
        const dateA = new Date(a.date.split('.').reverse().join('-'));
        const dateB = new Date(b.date.split('.').reverse().join('-'));
        return dateB - dateA;
    });
    
    // –ü–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    let totalExercises = 0;
    let workoutsWithWeight = 0;
    let totalWeight = 0;
    
    // –î–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ
    sortedWorkouts.forEach((workout, index) => {
        report += `–¢–†–ï–ù–ò–†–û–í–ö–ê ${index + 1}\n`;
        report += `–î–∞—Ç–∞: ${workout.date}\n`;
        const russianType = workoutTypeMapping[workout.type] || workout.type;
		report += `–¢–∏–ø: ${russianType}\n`;
        report += '\n';
        
        // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        report += '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:\n';
        workout.exercises.forEach((ex, exIndex) => {
            totalExercises++;
            report += `  ${exIndex + 1}. ${ex.name}`;
            if (ex.spec) {
                report += ` (${ex.spec})`;
            }
            report += '\n';
            
            const weightInfo = formatWeightSetsForReport(ex.weightSets);
            if (weightInfo) {
                report += `     ${weightInfo}\n`;
            }
            
            if (ex.note) {
                report += `     –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: ${ex.note}\n`;
            }
            report += '\n';
        });
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        if (workout.extraActivity) {
            report += `–î–æ–ø. –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${workout.extraActivity}\n`;
        }
        
        // –í–µ—Å –∏ BMI
        if (workout.weight) {
            workoutsWithWeight++;
            totalWeight += workout.weight;
            report += `–í–µ—Å –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: ${workout.weight} –∫–≥\n`;
            if (workout.bmi) {
                report += `–ò–Ω–¥–µ–∫—Å BMI: ${workout.bmi}\n`;
            }
        }
        
        report += '-'.repeat(40) + '\n\n';
    });
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –∫–æ–Ω—Ü–µ –æ—Ç—á–µ—Ç–∞
    report += '='.repeat(60) + '\n';
    report += '–°–¢–ê–¢–ò–°–¢–ò–ö–ê\n';
    report += '='.repeat(60) + '\n\n';
    
    report += `–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${workouts.length}\n`;
    report += `–í—Å–µ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: ${totalExercises}\n`;
    
    if (workoutsWithWeight > 0) {
        const avgWeight = totalWeight / workoutsWithWeight;
        report += `–°—Ä–µ–¥–Ω–∏–π –≤–µ—Å: ${avgWeight.toFixed(1)} –∫–≥ (–Ω–∞ –æ—Å–Ω–æ–≤–µ ${workoutsWithWeight} –∑–∞–ø–∏—Å–µ–π)\n`;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∞–º—É—é —á–∞—Å—Ç—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
    const typeCounts = {};
    workouts.forEach(w => {
        typeCounts[w.type] = (typeCounts[w.type] || 0) + 1;
    });
    
    let mostFrequentType = '';
    let maxCount = 0;
    Object.keys(typeCounts).forEach(type => {
        if (typeCounts[type] > maxCount) {
            maxCount = typeCounts[type];
            mostFrequentType = type;
        }
    });
    
   if (mostFrequentType) {
    const russianFrequentType = workoutTypeMapping[mostFrequentType] || mostFrequentType;
    report += `–°–∞–º—ã–π —á–∞—Å—Ç—ã–π —Ç–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: ${russianFrequentType} (${maxCount} —Ä–∞–∑)\n`;
}
    
    report += '\n' + '='.repeat(60) + '\n';
    report += '–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞\n';
    report += '='.repeat(60) + '\n';
    
    return report;
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ TXT —Ñ–∞–π–ª–∞
function downloadTextReport(content, period) {
    const periodNames = {
        'all': '–≤—Å–µ_—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
        'week': '–Ω–µ–¥–µ–ª—è',
        'month': '–º–µ—Å—è—Ü',
        'custom': '–ø–µ—Ä–∏–æ–¥'
    };
    
    const fileName = `–æ—Ç—á–µ—Ç_—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫_${periodNames[period]}_${new Date().toISOString().slice(0, 10)}.txt`;
    
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    
    setTimeout(() => URL.revokeObjectURL(url), 100);
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞
function createWorkoutReport() {
    const period = document.querySelector('input[name="reportPeriod"]:checked').value;
    let dateFrom = '';
    let dateTo = '';
    
    if (period === 'custom') {
        dateFrom = document.getElementById('reportDateFrom').value.trim();
        dateTo = document.getElementById('reportDateTo').value.trim();
        
        if (!dateFrom || !dateTo) {
            showNotification('–£–∫–∞–∂–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –¥–ª—è –ø–µ—Ä–∏–æ–¥–∞', false);
            return;
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
        const dateRegex = /^\d{2}\.\d{2}\.\d{4}$/;
        if (!dateRegex.test(dateFrom) || !dateRegex.test(dateTo)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì', false);
            return;
        }
    }
    
    const allWorkouts = loadWorkoutLog();
    const filteredWorkouts = filterWorkoutsByPeriod(allWorkouts, period, dateFrom, dateTo);
    
    if (filteredWorkouts.length === 0) {
        showNotification('–ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥', false);
        closeReportModal();
        return;
    }
    
    const reportContent = generateTextReport(filteredWorkouts, period);
    downloadTextReport(reportContent, period);
    
    showNotification(`–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω! –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${filteredWorkouts.length} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫`);
    closeReportModal();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –æ—Ç—á–µ—Ç–∞
function initReportFunctionality() {
    // –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞
    document.getElementById('exportReportBtn').addEventListener('click', showReportModal);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç—á–µ—Ç–∞
    document.getElementById('closeReportModal').addEventListener('click', closeReportModal);
    document.getElementById('cancelReportBtn').addEventListener('click', closeReportModal);
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
    document.querySelectorAll('input[name="reportPeriod"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('customDatesContainer').style.display = 
                this.value === 'custom' ? 'block' : 'none';
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
    document.getElementById('generateReportBtn').addEventListener('click', createWorkoutReport);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
    document.getElementById('reportModal').addEventListener('click', function(event) {
        if (event.target === this) {
            closeReportModal();
        }
    });
}
</script>

<div class="import-modal" id="reportModal">
    <div class="import-modal-content">
        <div class="form-header">
            <h2><i class="fas fa-file-export"></i> –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞</h2>
            <button class="btn-close-form" id="closeReportModal">&times;</button>
        </div>
        
        <div class="form-section">
            <h3><i class="fas fa-calendar-alt"></i> –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h3>
            
            <div class="import-options">
                <div class="import-option">
                    <input type="radio" id="periodAll" name="reportPeriod" value="all" checked>
                    <label for="periodAll">–í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
                    <div class="hint">–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ.</div>
                </div>
                
                <div class="import-option">
                    <input type="radio" id="periodWeek" name="reportPeriod" value="week">
                    <label for="periodWeek">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é</label>
                    <div class="hint">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π.</div>
                </div>
                
                <div class="import-option">
                    <input type="radio" id="periodMonth" name="reportPeriod" value="month">
                    <label for="periodMonth">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</label>
                    <div class="hint">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π.</div>
                </div>
                
                <div class="import-option">
                    <input type="radio" id="periodCustom" name="reportPeriod" value="custom">
                    <label for="periodCustom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</label>
                    <div class="hint">–£–∫–∞–∂–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É.</div>
                </div>
            </div>
            
            <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –¥–∞—Ç (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥") -->
            <div id="customDatesContainer" style="display: none; margin-top: 20px;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="reportDateFrom">–î–∞—Ç–∞ —Å</label>
                        <input type="text" id="reportDateFrom" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì">
                    </div>
                    <div class="form-group">
                        <label for="reportDateTo">–î–∞—Ç–∞ –ø–æ</label>
                        <input type="text" id="reportDateTo" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" value="">
                    </div>
                </div>
                <div class="hint">–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: –¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15.05.2023)</div>
            </div>
        </div>
        
        <div class="form-actions" style="margin-top: 30px;">
            <button type="button" class="btn-cancel" id="cancelReportBtn">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn-submit" id="generateReportBtn">–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</button>
        </div>
    </div>
</div>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/workout-diary/service-worker.js')
      .then(registration => {
        console.log('ServiceWorker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
      })
      .catch(error => {
        console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker:', error);
      });
  });
}
</script>
<script>
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Service Worker
if ('serviceWorker' in navigator) {
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  navigator.serviceWorker.register('/workout-diary/service-worker.js')
    .then(registration => {
      console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
      registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        console.log('–ù–∞–π–¥–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Service Worker');
        
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            console.log('–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            if (confirm('–î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å?')) {
              window.location.reload();
            }
          }
        });
      });
    })
    .catch(error => {
      console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker:', error);
    });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ª–∏ Service Worker —Å—Ç—Ä–∞–Ω–∏—Ü—É
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    console.log('Controller changed, reloading page');
    window.location.reload();
  });
}

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
if (window.location.hostname === 'localhost' || window.location.hostname.includes('github.io')) {
  caches.keys().then(cacheNames => {
    cacheNames.forEach(cacheName => {
      caches.delete(cacheName);
      console.log('–£–¥–∞–ª—ë–Ω –∫—ç—à:', cacheName);
    });
  });
}

</script>
</body>
</html>





